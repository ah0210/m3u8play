# 终极版 M3U8/MP4 播放器

一个功能强大、支持多种播放格式、可直接在浏览器中运行的视频播放器应用。

## 功能特性

### 核心播放功能
- ✅ 支持 M3U8 (HLS) 格式播放
- ✅ 支持 MP4 等标准视频格式
- ✅ 自动识别视频格式，智能切换播放模式
- ✅ 动态加载 HLS.js，优化初始加载速度

### 播放控制
- ✅ 播放/暂停控制
- ✅ 进度条拖拽定位
- ✅ 音量调节（滑块+快捷键）
- ✅ 倍速播放（0.5x - 2x）
- ✅ 画质选择（仅 M3U8 支持）
- ✅ 全屏/退出全屏
- ✅ 画中画模式
- ✅ 截图功能

### 智能功能
- ✅ 播放位置记忆
- ✅ 断网自动重连
- ✅ 倍速设置记忆
- ✅ 播放历史记录（最多保存20条）
- ✅ 主题切换（亮色/暗色）
- ✅ 国际化支持（中文/英文）

### 性能优化
- ✅ 动态资源加载
- ✅ PWA 支持，可离线使用
- ✅ 响应式设计，适配移动端
- ✅ 移动端触摸手势支持
- ✅ 缓存清理功能

### 开发辅助
- ✅ 播放日志记录
- ✅ 快捷键提示
- ✅ 状态反馈提示
- ✅ 控制台日志输出

## 技术栈

- **HTML5** - 页面结构
- **CSS3** - 样式设计
- **JavaScript (ES6+)** - 核心逻辑
- **HLS.js** - M3U8 格式支持
- **Service Worker** - 离线缓存
- **PWA (Progressive Web App)** - 应用化支持

## 安装和使用

### 方法一：直接使用（推荐）

1. 下载项目文件
2. 直接在浏览器中打开 `play.html` 文件
3. 在输入框中输入视频 URL，点击"加载视频"按钮
4. 开始播放视频

### 方法二：本地服务器运行（推荐用于开发和调试）

1. 确保已安装 Node.js
2. 进入项目目录：
   ```bash
   cd e:\live\m3u8play
   ```
3. 安装依赖（包括本地 `serve` 包）：
   ```bash
   npm install
   ```
4. 启动本地服务器：
   ```bash
   npm start
   ```
5. 在浏览器中访问：
   ```
   http://localhost:3000
   ```

#### 服务管理命令

- **启动服务**：`npm start`
- **停止服务**：`npm run stop`
- **快速运行（无需安装依赖）**：`npx serve -s . -l 3000`
- **开发模式**：`npm run dev`（同 `npm start`）

#### 本地服务

- **启动服务**：`npx serve`
```
   │Serving!                                  │
   │                                          │
   │   - Local:    http://localhost:3000      │
   │   - Network:  http://192.168.1.35:3000   │
   │                                          │
   │   Copied local address to clipboard!     │
```
- **停止服务**：`Ctrl + C` 
               `taskkill /pid 3000 /f  # 替换 1234 为实际 PID`

- **批量停止**：
`Windows：taskkill /f /im node.exe；`
`Mac/Linux：pkill node。`            

#### 服务管理特性

- ✅ 自动检查服务是否已在运行
- ✅ 显示服务 PID，方便手动管理
- ✅ 支持优雅停止服务
- ✅ 自动清理无效的 PID 文件
- ✅ 跨平台支持（Windows/macOS/Linux）
- ✅ 轻量级实现，不依赖额外重型库

### 方法三：部署到服务器

1. 将项目文件上传到您的 Web 服务器
2. 通过浏览器访问 `play.html` 文件的 URL
3. 开始使用播放器

## 浏览器兼容性

| 浏览器 | 支持版本 | 备注 |
|--------|----------|------|
| Chrome | 60+ | 完全支持所有功能 |
| Firefox | 65+ | 完全支持所有功能 |
| Safari | 13+ | 原生支持 HLS，无需额外插件 |
| Edge | 79+ | 基于 Chromium，完全支持 |
| Opera | 47+ | 支持所有功能 |
| iOS Safari | 13+ | 支持 PWA 和画中画 |
| Android Chrome | 60+ | 支持 PWA 和触摸手势 |

## PWA 支持

本播放器支持渐进式 Web 应用（PWA），可将其安装到设备主屏幕，获得类似原生应用的体验：

### 安装步骤

1. 在支持 PWA 的浏览器中打开播放器
2. 浏览器会提示您"安装应用"或"添加到主屏幕"
3. 按照提示完成安装
4. 从主屏幕启动应用，享受全屏无广告的播放体验

### PWA 特性

- 📱 可安装到主屏幕
- 🎯 全屏运行，无浏览器 UI
- 🔌 离线使用（已缓存资源）
- ⚡ 快速启动
- 🔔 推送通知支持（可选扩展）

## 快捷键说明

| 快捷键 | 功能 |
|--------|------|
| `空格` | 播放/暂停 |
| `→` | 快进 5 秒 |
| `←` | 后退 5 秒 |
| `↑` | 音量 +5% |
| `↓` | 音量 -5% |
| `F` 或 `f` | 全屏/退出全屏 |
| `P` 或 `p` | 画中画/退出画中画 |
| `S` 或 `s` | 截图 |

## 移动端触摸手势

- **双击**：播放/暂停
- **横向滑动**：调整播放进度
- **纵向滑动**：调整音量

## 项目结构

```
m3u8play/
├── play.html          # 主播放器页面
├── README.md          # 项目说明文档
├── package.json       # 项目依赖配置
├── manifest.json      # PWA 配置文件
├── generate-icons.html # 图标生成页面
├── generate-icons.js   # 图标生成脚本
├── download-icons.html # 图标下载页面
├── css/               # CSS 样式文件
│   └── style.css      # 主样式文件
├── js/                # JavaScript 文件
│   ├── script.js      # 主播放器逻辑
│   ├── i18n.js        # 国际化配置
│   └── service-worker.js # 服务工作线程，负责离线缓存
└── icons/             # 应用图标
    ├── README.md      # 图标生成说明
    ├── icon.svg       # SVG 图标模板
    ├── icon-96x96.png    # 96x96 像素图标
    ├── icon-192x192.png  # 192x192 像素图标
    ├── icon-512x512.png  # 512x512 像素图标
    ├── icon-maskable-192x192.png  # 192x192 像素遮罩图标
    └── icon-maskable-512x512.png  # 512x512 像素遮罩图标
```

## 配置说明

### 自定义主题

播放器支持亮色和暗色两种主题，可通过右上角的主题选择器切换。主题设置会自动保存到本地存储。

### 国际化

支持中文和英文两种语言，可通过右上角的语言选择器切换。语言设置会自动保存到本地存储。

### 缓存管理

点击"清理缓存"按钮可清除所有本地存储的播放记录、倍速设置和主题偏好。

## 开发和调试

### 开发环境搭建

1. 克隆或下载项目文件
2. 使用本地服务器运行（如 `serve -l 8080`）
3. 在浏览器中打开开发者工具进行调试
4. 修改代码后刷新页面查看效果

### 日志查看

- 点击"播放日志"可展开查看详细的播放日志
- 日志包含加载状态、错误信息、用户操作等
- 控制台同时输出详细日志，便于开发调试

### 性能优化建议

- 对于大型 M3U8 文件，建议使用 CDN 加速
- 定期清理缓存，保持播放器性能
- 移动端使用时，建议关闭不必要的后台应用

## 常见问题

### Q: 为什么 M3U8 视频无法播放？

A: 可能的原因：
1. 视频链接无效或已过期
2. 网络连接问题
3. 浏览器不支持 HLS 格式（请升级浏览器或确保已加载 HLS.js）
4. CORS 跨域限制（请确保视频服务器允许跨域访问）

### Q: 为什么无法截图？

A: 可能的原因：
1. 浏览器限制了截图功能
2. 视频使用了 DRM 加密保护
3. 跨域限制导致无法访问视频帧

### Q: 为什么无法进入画中画模式？

A: 可能的原因：
1. 浏览器不支持画中画 API
2. 视频未开始播放
3. 浏览器策略限制（如部分移动浏览器）

### Q: 如何将播放器嵌入到我的网站？

A: 您可以通过 iframe 方式嵌入：
```html
<iframe src="path/to/play.html" width="100%" height="500px" frameborder="0"></iframe>
```

## 许可证

本项目采用 MIT 许可证，详见 LICENSE 文件。

## 贡献

欢迎提交 Issue 和 Pull Request，共同改进这个播放器！

## 更新日志

### v1.1.1 (2025-12-31)
- ✅ 新增启动和停止本地服务的脚本
- ✅ 支持 `npm start` 启动服务
- ✅ 支持 `npm run stop` 停止服务
- ✅ 自动检查服务状态，避免重复启动
- ✅ 轻量级实现，不依赖额外重型库
- ✅ 跨平台支持（Windows/macOS/Linux）
- ✅ 视频链接输入框新增清除按钮
- ✅ 优化了输入框的用户体验

### v1.1.0 (2025-12-31)
- ✅ 新增播放历史记录功能（最多保存20条）
- ✅ 支持查看和管理播放历史
- ✅ 点击历史记录可直接播放视频
- ✅ 支持删除单条或清空所有历史记录
- ✅ 历史记录包含播放进度、时长和日期
- ✅ 添加了package.json，支持本地serve依赖
- ✅ 优化了控制按钮样式和交互
- ✅ 文字提示默认隐藏，鼠标悬停时显示
- ✅ 控制图标旁文字显示在按钮上方

### v1.0.0 (2025-12-30)
- ✅ 初始版本发布
- ✅ 支持 M3U8 和 MP4 格式
- ✅ PWA 支持
- ✅ 响应式设计
- ✅ 国际化支持
- ✅ 播放位置记忆
- ✅ 快捷键支持
- ✅ 移动端触摸手势

## 联系方式

如有问题或建议，欢迎通过以下方式联系：

- 提交 Issue：[GitHub Issues](https://github.com/ah0210/m3u8play/issues)
- 邮箱：163828@qq.com

---

**享受观影时光！** 🎬

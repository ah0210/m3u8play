# 终极版 M3U8/MP4 播放器

一个功能强大、支持多种播放格式、可直接在浏览器中运行的视频播放器应用。

## 功能特性

### 核心播放功能
- ✅ 支持 M3U8 (HLS) 格式播放
- ✅ 支持 MP4 等标准视频格式
- ✅ 自动识别视频格式，智能切换播放模式
- ✅ 动态加载 HLS.js，优化初始加载速度

### 播放控制
- ✅ 播放/暂停控制
- ✅ 进度条拖拽定位
- ✅ 音量调节（滑块+快捷键）
- ✅ 倍速播放（0.5x - 2x）
- ✅ 画质选择（仅 M3U8 支持）
- ✅ 全屏/退出全屏
- ✅ 画中画模式
- ✅ 截图功能

### 智能功能
- ✅ 播放位置记忆
- ✅ 断网自动重连
- ✅ 倍速设置记忆
- ✅ 主题切换（亮色/暗色）
- ✅ 国际化支持（中文/英文）
- ✅ 播放历史记录管理
- ✅ 播放列表功能（支持多个播放列表）
- ✅ 播放列表导入/导出（M3U格式）
- ✅ 自动导入默认播放历史
- ✅ 可拖动侧边栏调整宽度

### 性能优化
- ✅ 动态资源加载
- ✅ PWA 支持，可离线使用
- ✅ 响应式设计，适配移动端
- ✅ 移动端触摸手势支持
- ✅ 缓存清理功能

### 开发辅助
- ✅ 播放日志记录
- ✅ 快捷键提示
- ✅ 状态反馈提示
- ✅ 控制台日志输出

### 直播源

- **IPTV直播源地址：** https://iptv.hacks.tools/
- **直播源汇总：** https://www.juwanhezi.com/more/live
- **直播源搜索：**  https://tonkiang.us/
- **格式转换：** https://yang-1989.eu.org/Conversion.php

## 技术栈

- **HTML5** - 页面结构
- **CSS3** - 样式设计
- **JavaScript (ES6+)** - 核心逻辑
- **HLS.js** - M3U8 格式支持
- **IndexedDB** - 播放历史/列表本地存储
- **Vite** - 开发/构建工具链
- **Service Worker** - 离线缓存
- **PWA (Progressive Web App)** - 应用化支持

## 安装和使用

### 方法一：直接使用

1. 下载项目文件
2. 直接在浏览器中打开根目录的 `index.html`
3. 在输入框中输入视频 URL，开始播放

> 说明：部分浏览器会限制 `file://` 场景下的能力（例如 Service Worker / PWA），建议使用下方“本地开发服务器”方式运行。

### 方法二：本地服务器运行（推荐）

1. 确保已安装 Node.js
2. 进入项目目录：
   ```bash
   cd m3u8play
   ```
3. 安装依赖：
   ```bash
   npm install
   ```
4. 启动开发服务器：
   ```bash
   npm run dev
   ```
5. 在浏览器中访问：
   ```
   http://localhost:5173
   ```

### 方法三：构建与预览（部署前建议）

1. 构建生产产物：
   ```bash
   npm run build
   ```
2. 本地预览生产产物：
   ```bash
   npm run preview
   ```
3. 在浏览器中访问：
   ```
   http://localhost:4173
   ```

### 方法四：部署到服务器

1. 执行 `npm run build` 生成 `dist/`
2. 将 `dist/` 上传到静态托管（Nginx / GitHub Pages / Netlify / Vercel 等）
3. 访问部署后的站点即可使用播放器

### 常用命令

| 命令 | 功能 |
|------|------|
| `npm install` | 安装本地依赖 |
| `npm run dev` | 启动开发服务器（Vite） |
| `npm run build` | 构建生产产物到 `dist/` |
| `npm run preview` | 本地预览 `dist/`（需先 build） |

### 关于依赖

- ✅ 项目使用**本地依赖**，无需全局安装任何工具
- ✅ 所有依赖都在 `node_modules` 目录中，版本隔离
- ✅ 直接运行 `npm install` 即可安装所有所需依赖
- ✅ 支持跨平台运行（Windows/macOS/Linux）

## 浏览器兼容性

| 浏览器 | 支持版本 | 备注 |
|--------|----------|------|
| Chrome | 60+ | 完全支持所有功能 |
| Firefox | 65+ | 完全支持所有功能 |
| Safari | 13+ | 原生支持 HLS，无需额外插件 |
| Edge | 79+ | 基于 Chromium，完全支持 |
| Opera | 47+ | 支持所有功能 |
| iOS Safari | 13+ | 支持 PWA 和画中画 |
| Android Chrome | 60+ | 支持 PWA 和触摸手势 |

## PWA 支持

本播放器支持渐进式 Web 应用（PWA），可将其安装到设备主屏幕，获得类似原生应用的体验：

### 安装步骤

1. 在支持 PWA 的浏览器中打开播放器
2. 浏览器会提示您"安装应用"或"添加到主屏幕"
3. 按照提示完成安装
4. 从主屏幕启动应用，享受全屏无广告的播放体验

### PWA 特性

- 📱 可安装到主屏幕
- 🎯 全屏运行，无浏览器 UI
- 🔌 离线使用（已缓存资源）
- ⚡ 快速启动
- 🔔 推送通知支持（可选扩展）

## 快捷键说明

| 快捷键 | 功能 |
|--------|------|
| `空格` | 播放/暂停 |
| `→` | 快进 5 秒 |
| `←` | 后退 5 秒 |
| `↑` | 音量 +5% |
| `↓` | 音量 -5% |
| `F` 或 `f` | 全屏/退出全屏 |
| `P` 或 `p` | 画中画/退出画中画 |
| `S` 或 `s` | 截图 |

## 播放列表功能

### 播放历史管理

播放器会自动记录您观看过的视频，包括：
- 视频标题和URL
- 观看时间
- 播放进度
- 播放次数

您可以在左侧播放历史面板中查看和管理所有播放记录。

### 播放列表功能

播放器支持创建和管理多个播放列表：

1. **默认播放列表**：显示所有播放历史记录
2. **自定义播放列表**：可以导入和管理多个播放列表

### 播放列表导入/导出

- **导入播放列表**：支持导入M3U格式的播放列表文件
- **导出播放列表**：可以将当前播放列表导出为M3U格式
- **自动导入**：首次使用时，如果播放历史为空，会自动导入根目录下的 `play-history-2026-01-17.m3u` 文件

### 播放列表操作

- **选择播放列表**：通过下拉菜单选择不同的播放列表
- **播放视频**：点击播放按钮即可播放列表中的视频
- **删除记录**：可以删除不需要的播放记录
- **编辑标题**：可以编辑视频的显示标题

### 侧边栏调整

- **拖动调整**：可以通过拖动侧边栏调整左侧播放历史面板的宽度
- **缩进/展开**：点击侧边栏按钮可以缩进或展开播放历史面板

## 移动端触摸手势

- **双击**：播放/暂停
- **横向滑动**：调整播放进度
- **纵向滑动**：调整音量

## 项目结构

```
m3u8play/
├── index.html          # 主播放器页面
├── README.md          # 项目说明文档
├── package.json       # 项目依赖配置
├── manifest.json      # PWA 配置文件
├── vite.config.js     # Vite 配置
├── css/               # CSS 样式文件
│   └── style.css      # 主样式文件
├── js/                # JavaScript 文件
│   ├── script.js      # 主播放器逻辑
│   ├── i18n.js        # 国际化配置
│   ├── storage.js     # IndexedDB 存储管理
│   └── service-worker.js # 服务工作线程，负责离线缓存
├── scripts/           # 构建后处理脚本
│   └── copy-files.js  # 将额外文件复制到 dist，并修复资源引用
├── src/               # 源代码目录
│   ├── index.html     # 源HTML文件
│   ├── manifest.json  # PWA配置文件
│   ├── play-history-2026-01-17.m3u  # 默认播放历史文件
│   ├── css/           # CSS样式文件
│   │   └── style.css  # 主样式文件
│   ├── js/            # JavaScript文件
│   │   ├── script.js  # 主播放器逻辑
│   │   ├── i18n.js    # 国际化配置
│   │   ├── storage.js # IndexedDB存储管理
│   │   └── service-worker.js # 服务工作线程
│   └── icons/         # 应用图标
│       ├── icon.svg   # SVG图标模板
│       ├── icon-96x96.png    # 96x96像素图标
│       ├── icon-192x192.png  # 192x192像素图标
│       ├── icon-512x512.png  # 512x512像素图标
│       ├── icon-maskable-192x192.png  # 192x192像素遮罩图标
│       └── icon-maskable-512x512.png  # 512x512像素遮罩图标
├── dist/              # 构建产物（npm run build 生成）
└── icons/             # 应用图标
    ├── icon.svg       # SVG 图标模板
    ├── icon-96x96.png    # 96x96 像素图标
    ├── icon-192x192.png  # 192x192 像素图标
    ├── icon-512x512.png  # 512x512 像素图标
    ├── icon-maskable-192x192.png  # 192x192 像素遮罩图标
    └── icon-maskable-512x512.png  # 512x512 像素遮罩图标
```

## 配置说明

### 自定义主题

播放器支持亮色和暗色两种主题，可通过右上角的主题选择器切换。主题设置会自动保存到本地存储。

### 国际化

支持中文和英文两种语言，可通过右上角的语言选择器切换。语言设置会自动保存到本地存储。

### 缓存管理

点击“清理缓存”按钮可清除播放器相关设置（倍速/主题/语言/音量/画质/对齐/排序/上次播放地址等），保留播放记录。

## 开发和调试

### 开发环境搭建

1. 克隆或下载项目文件
2. 安装本地依赖：`npm install`
3. 启动开发服务器：`npm run dev`
4. 在浏览器中打开开发者工具进行调试
5. 修改代码后刷新页面查看效果

### 开发模式说明

- 使用 `npm run dev` 启动开发服务器
- 开发服务器默认监听 5173 端口，访问地址：`http://localhost:5173`
- 支持热重载（修改代码后刷新页面即可）
- 提供详细的日志输出，便于调试

### 日志查看

- 点击"播放日志"可展开查看详细的播放日志
- 日志包含加载状态、错误信息、用户操作等
- 控制台同时输出详细日志，便于开发调试

### 性能优化建议

- 对于大型 M3U8 文件，建议使用 CDN 加速
- 定期清理缓存，保持播放器性能
- 移动端使用时，建议关闭不必要的后台应用

## 常见问题

### Q: 为什么 M3U8 视频无法播放？

A: 可能的原因：
1. 视频链接无效或已过期
2. 网络连接问题
3. 浏览器不支持 HLS 格式（请升级浏览器或确保已加载 HLS.js）
4. CORS 跨域限制（请确保视频服务器允许跨域访问）

### Q: 为什么无法截图？

A: 可能的原因：
1. 浏览器限制了截图功能
2. 视频使用了 DRM 加密保护
3. 跨域限制导致无法访问视频帧

### Q: 为什么无法进入画中画模式？

A: 可能的原因：
1. 浏览器不支持画中画 API
2. 视频未开始播放
3. 浏览器策略限制（如部分移动浏览器）

### Q: 如何将播放器嵌入到我的网站？

A: 您可以通过 iframe 方式嵌入：
```html
<iframe src="path/to/index.html" width="100%" height="500px" frameborder="0"></iframe>
```

## 许可证

本项目采用 MIT 许可证，详见 LICENSE 文件。

## 贡献

欢迎提交 Issue 和 Pull Request，共同改进这个播放器！

## 更新日志

### v1.2.1 (2026-02-06)
- 标题栏增加“自游人”链接与不蒜子 PV/UV 统计展示

### v1.2.0 (2026-01-17)
- 新增播放历史记录管理功能
- 新增播放列表功能，支持多个播放列表
- 新增播放列表导入/导出功能（支持M3U格式）
- 新增自动导入默认播放历史功能
- 新增可拖动侧边栏调整宽度功能
- 新增播放历史排序功能（按时间/热度）
- 新增播放历史编辑功能
- 优化播放历史显示，添加播放进度和播放次数统计
- 优化播放历史列表的初始化显示
- 优化播放按钮交互，点击播放不关闭播放历史列表

### v1.1.1 (2025-12-31)
- 优化了输入框的用户体验
- 视频链接输入框新增清除按钮

### v1.1.0 (2025-12-31)
- 添加了package.json，支持本地serve依赖
- 优化了控制按钮样式和交互
- 文字提示默认隐藏，鼠标悬停时显示
- 控制图标旁文字显示在按钮上方

### v1.0.0 (2025-12-30)
- 初始版本发布
- 支持 M3U8 和 MP4 格式
- PWA 支持
- 响应式设计
- 国际化支持
- 播放位置记忆
- 快捷键支持
- 移动端触摸手势

## 联系方式

如有问题或建议，欢迎通过以下方式联系：

- 提交 Issue：[GitHub Issues](https://github.com/ah0210/m3u8play/issues)

---

**享受观影时光！** 🎬

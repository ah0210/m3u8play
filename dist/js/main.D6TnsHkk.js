var e,t,s=Object.getOwnPropertyNames,n=(e={"js/main.D6TnsHkk.js"(e,t){!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();class s{constructor(){this.dbName="videoPlayerDB",this.storeName="playHistory",this.dbVersion=1,this.db=null}async openDB(){return new Promise((e,t)=>{if(this.db)return void e(this.db);const s=indexedDB.open(this.dbName,this.dbVersion);s.onupgradeneeded=e=>{if(this.db=e.target.result,!this.db.objectStoreNames.contains(this.storeName)){const e=this.db.createObjectStore(this.storeName,{keyPath:"url",autoIncrement:!1});e.createIndex("date","date",{unique:!1}),e.createIndex("playCount","playCount",{unique:!1})}},s.onsuccess=t=>{this.db=t.target.result,e(this.db)},s.onerror=e=>{t(e.target.error)}})}async saveRecord(e){try{const t=await this.openDB(),s=t.transaction(this.storeName,"readwrite").objectStore(this.storeName);await new Promise((t,n)=>{const o=s.put(e);o.onsuccess=t,o.onerror=n})}catch(t){throw t}}async getAllRecords(e={}){const{sortBy:t="date",sortOrder:s="desc",limit:n=120}=e;try{const e=(await this.openDB()).transaction(this.storeName,"readonly"),o=e.objectStore(this.storeName).index(t);return new Promise((e,t)=>{const r=[],l="asc"===s?"next":"prev",a=o.openCursor(null,l);a.onsuccess=t=>{const s=t.target.result;s&&r.length<n?(r.push(s.value),s.continue()):e(r)},a.onerror=t})}catch(o){return[]}}async getRecord(e){try{const t=await this.openDB(),s=t.transaction(this.storeName,"readonly").objectStore(this.storeName);return new Promise((t,n)=>{const o=s.get(e);o.onsuccess=e=>t(e.target.result),o.onerror=n})}catch(t){return null}}async deleteRecord(e){try{const t=await this.openDB(),s=t.transaction(this.storeName,"readwrite").objectStore(this.storeName);await new Promise((t,n)=>{const o=s.delete(e);o.onsuccess=t,o.onerror=n})}catch(t){throw t}}async clearAllRecords(){try{const e=await this.openDB(),t=e.transaction(this.storeName,"readwrite").objectStore(this.storeName);await new Promise((e,s)=>{const n=t.clear();n.onsuccess=e,n.onerror=s})}catch(e){throw e}}async getRecordCount(){try{const e=await this.openDB(),t=e.transaction(this.storeName,"readonly").objectStore(this.storeName);return new Promise((e,s)=>{const n=t.count();n.onsuccess=t=>e(t.target.result),n.onerror=s})}catch(e){return 0}}}const n=new s;void 0!==t&&t.exports?t.exports=s:window.playHistoryStorage=n;const o={"zh-CN":{pageTitle:"终极版 M3U8/MP4 播放器",langLabel:"语言",themeLabel:"主题",volumeLabel:"音量",speedLabel:"倍速",qualityLabel:"画质",loadPlayBtn:"加载播放",pauseBtn:"暂停",fullscreenBtn:"全屏",pipBtn:"画中画",screenshotBtn:"截图",shortcutBtn:"快捷键",clearCacheBtn:"清理缓存",historyBtn:"播放历史",historyTitle:"播放历史",clearHistoryBtn:"清空历史",playlistBtn:"列表",playlistModalTitle:"播放列表",playlistFileBtn:"从文件",playlistImportBtn:"导入",playlistClearBtn:"清空",playlistTextareaPlaceholder:"粘贴 M3U 内容...",playlistEmpty:"暂无播放列表",alignLabel:"对齐",urlInputPlaceholder:"输入 m3u8/MP4 链接",loadingText:"加载中...",statusSuccessLoad:"视频加载完成，可播放",statusSuccessLoadNative:"视频加载完成（原生 HLS）",statusSuccessPlay:"视频播放中",statusSuccessPause:"视频已暂停",statusSuccessEnd:"视频播放完毕",statusSuccessFullscreen:"已进入全屏模式",statusSuccessExitFullscreen:"已退出全屏模式",statusSuccessPip:"已进入画中画模式",statusSuccessExitPip:"已退出画中画模式",statusSuccessSpeed:"已切换至 {speed} 倍速播放",statusSuccessQuality:"已切换至 {quality} 画质",statusSuccessScreenshot:"截图成功，可在弹窗中下载",statusSuccessScreenshotDownload:"截图已下载",statusSuccessClearCache:"缓存已清理完成",statusErrorUrl:"错误：请输入有效的视频链接",statusErrorLoad:"视频加载失败",statusErrorNetwork:"错误：网络请求失败，请检查链接或网络",statusErrorDecode:"错误：视频解码失败，格式不支持",statusErrorUnknown:"错误：{msg}",statusErrorVideo:"错误：{msg}",statusErrorScreenshot:"截图失败：{msg}（可能受跨域限制）",statusErrorPip:"{action}画中画失败：{msg}（需视频播放后操作）",statusOffline:"⚠️ 网络已断开，将在恢复后自动重连",statusReconnect:"网络恢复，正在重新加载视频...",shortcutTitle:"快捷键说明",shortcutPlay:"播放/暂停",shortcutForward:"快进 5 秒",shortcutBackward:"后退 5 秒",shortcutVolUp:"音量+5%",shortcutVolDown:"音量-5%",shortcutFullscreen:"全屏/退出全屏",shortcutPip:"画中画/退出",shortcutScreenshot:"截图",touchTip:"双击播放/暂停",logTitle:"播放日志",screenshotDownload:"下载截图"},"en-US":{pageTitle:"Ultimate M3U8/MP4 Player",langLabel:"Language",themeLabel:"Theme",volumeLabel:"Volume",speedLabel:"Speed",qualityLabel:"Quality",loadPlayBtn:"Load & Play",pauseBtn:"Pause",fullscreenBtn:"Fullscreen",pipBtn:"PiP",screenshotBtn:"Screenshot",shortcutBtn:"Shortcuts",clearCacheBtn:"Clear Cache",historyBtn:"History",historyTitle:"Play History",clearHistoryBtn:"Clear History",playlistBtn:"Playlist",playlistModalTitle:"Playlist",playlistFileBtn:"From File",playlistImportBtn:"Import",playlistClearBtn:"Clear",playlistTextareaPlaceholder:"Paste M3U content...",playlistEmpty:"No playlist yet",alignLabel:"Align",urlInputPlaceholder:"Enter m3u8/MP4 URL",loadingText:"Loading...",statusSuccessLoad:"Video loaded successfully, ready to play",statusSuccessLoadNative:"Video loaded (Native HLS)",statusSuccessPlay:"Video playing",statusSuccessPause:"Video paused",statusSuccessEnd:"Video playback completed",statusSuccessFullscreen:"Entered fullscreen mode",statusSuccessExitFullscreen:"Exited fullscreen mode",statusSuccessPip:"Entered picture-in-picture mode",statusSuccessExitPip:"Exited picture-in-picture mode",statusSuccessSpeed:"Switched to {speed}x playback speed",statusSuccessQuality:"Switched to {quality} quality",statusSuccessScreenshot:"Screenshot taken, download in popup",statusSuccessScreenshotDownload:"Screenshot downloaded",statusSuccessClearCache:"Cache cleared successfully",statusErrorUrl:"Error: Please enter a valid video URL",statusErrorLoad:"Video load failed",statusErrorNetwork:"Error: Network request failed, check URL or network",statusErrorDecode:"Error: Video decoding failed, format not supported",statusErrorUnknown:"Error: {msg}",statusErrorVideo:"Error: {msg}",statusErrorScreenshot:"Screenshot failed: {msg} (may be restricted by CORS)",statusErrorPip:"{action} picture-in-picture failed: {msg} (operate after video plays)",statusOffline:"⚠️ Network disconnected, auto-reconnect when restored",statusReconnect:"Network restored, reloading video...",shortcutTitle:"Shortcut Keys",shortcutPlay:"Play/Pause",shortcutForward:"Forward 5s",shortcutBackward:"Backward 5s",shortcutVolUp:"Volume +5%",shortcutVolDown:"Volume -5%",shortcutFullscreen:"Fullscreen/Exit",shortcutPip:"PiP/Exit",shortcutScreenshot:"Screenshot",touchTip:"Double tap to play/pause",logTitle:"Playback Log",screenshotDownload:"Download Screenshot"}};void 0!==t&&t.exports?t.exports=o:"undefined"!=typeof window&&(window.i18n=o);let r=null,l=!1;const a={video:document.getElementById("video-player"),loadingMask:document.getElementById("loading-mask"),loadingText:document.getElementById("loading-text"),statusTip:document.getElementById("status-tip"),urlInput:document.getElementById("url-input"),urlClearBtn:document.getElementById("url-clear-btn"),fullscreenBtn:document.getElementById("fullscreen-btn"),pipBtn:document.getElementById("pip-btn"),screenshotBtn:document.getElementById("screenshot-btn"),shortcutBtn:document.getElementById("shortcut-btn"),clearCacheBtn:document.getElementById("clear-cache-btn"),helpBtn:document.getElementById("help-btn"),playlistBtn:document.getElementById("playlist-btn"),historyBtn:document.getElementById("history-btn"),historyPanel:document.getElementById("history-panel"),historyHeader:document.getElementById("history-header"),historyTitle:document.getElementById("historyTitle"),historyClear:document.getElementById("history-clear"),historyExport:document.getElementById("history-export"),historyImport:document.getElementById("history-import"),historyImportInput:document.getElementById("history-import-input"),historyBody:document.getElementById("history-body"),historyEmpty:document.getElementById("history-empty"),sortRecentBtn:document.getElementById("sort-recent"),sortHotBtn:document.getElementById("sort-hot"),alignLeftBtn:document.getElementById("align-left"),alignCenterBtn:document.getElementById("align-center"),alignRightBtn:document.getElementById("align-right"),volumeIcon:document.getElementById("volume-icon"),progressWrap:document.getElementById("progress-wrap"),progressBar:document.getElementById("progress-bar"),progressLoaded:document.getElementById("progress-loaded"),volumeSlider:document.getElementById("volume-slider"),speedSelect:document.getElementById("speed-select"),qualitySelect:document.getElementById("quality-select"),centerPlayBtn:document.getElementById("center-play-btn"),screenshotModal:document.getElementById("screenshot-modal"),screenshotImg:document.getElementById("screenshot-img"),screenshotClose:document.getElementById("screenshot-close"),screenshotDownload:document.getElementById("screenshot-download"),helpModal:document.getElementById("help-modal"),helpClose:document.getElementById("help-close"),playlistModal:document.getElementById("playlist-modal"),playlistClose:document.getElementById("playlist-close"),playlistModalTitle:document.getElementById("playlistModalTitle"),playlistFileBtn:document.getElementById("playlist-file-btn"),playlistFileBtnText:document.getElementById("playlistFileBtnText"),playlistFileInput:document.getElementById("playlist-file-input"),playlistImportBtn:document.getElementById("playlist-import-btn"),playlistImportBtnText:document.getElementById("playlistImportBtnText"),playlistClearBtn:document.getElementById("playlist-clear-btn"),playlistClearBtnText:document.getElementById("playlistClearBtnText"),playlistTextarea:document.getElementById("playlist-textarea"),playlistList:document.getElementById("playlist-list"),playlistEmpty:document.getElementById("playlist-empty"),shortcutTip:document.getElementById("shortcut-tip"),touchTip:document.getElementById("touch-tip"),langLabel:document.getElementById("langLabel"),themeLabel:document.getElementById("themeLabel"),speedLabel:document.getElementById("speedLabel"),qualityLabel:document.getElementById("qualityLabel"),shortcutTitle:document.getElementById("shortcutTitle"),shortcutPlay:document.getElementById("shortcutPlay"),shortcutForward:document.getElementById("shortcutForward"),shortcutBackward:document.getElementById("shortcutBackward"),shortcutVolUp:document.getElementById("shortcutVolUp"),shortcutVolDown:document.getElementById("shortcutVolDown"),shortcutFullscreen:document.getElementById("shortcutFullscreen"),shortcutPip:document.getElementById("shortcutPip"),shortcutScreenshot:document.getElementById("shortcutScreenshot"),pageTitle:document.getElementById("pageTitle"),langSelect:document.getElementById("lang-select"),themeSelect:document.getElementById("theme-select"),logHeader:document.getElementById("log-header"),logBody:document.getElementById("log-body"),logTitle:document.getElementById("logTitle"),logClear:document.getElementById("log-clear"),sidebar:document.getElementById("sidebar"),sidebarToggle:document.getElementById("sidebar-toggle"),historySidebarToggle:document.getElementById("history-sidebar-toggle")};let i=null,c=!1,d="",u=null,m=null,p=localStorage.getItem("playerLang")||"zh-CN",y=null;function h(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}function g(){return window.playHistoryStorage||null}function v(e){if(!e||"string"!=typeof e)return!1;try{const t=new URL(e);return["http:","https:"].includes(t.protocol)}catch(t){return/^https?:\/\/.+\.(m3u8|mp4|webm|ogg|avi|mov|wmv)/i.test(e)||/^https?:\/\/.+\/playlist\.m3u8/i.test(e)}}const f="playerPlaylist_v1";function E(){try{const e=localStorage.getItem(f);if(!e)return{version:1,epgUrls:[],items:[]};const t=JSON.parse(e);if(!t||"object"!=typeof t)return{version:1,epgUrls:[],items:[]};const s=Array.isArray(t.epgUrls)?t.epgUrls.filter(e=>"string"==typeof e):[];return{version:1,epgUrls:s,items:Array.isArray(t.items)?t.items.filter(e=>e&&"object"==typeof e):[]}}catch{return{version:1,epgUrls:[],items:[]}}}function B(e){const t={version:1,epgUrls:Array.isArray(e?.epgUrls)?e.epgUrls:[],items:Array.isArray(e?.items)?e.items:[]};localStorage.setItem(f,JSON.stringify(t))}function w(e){return"string"!=typeof e?"":function(e){if("string"!=typeof e)return"";const t=e.trim();return t.startsWith('"')&&t.endsWith('"')||t.startsWith("'")&&t.endsWith("'")?t.slice(1,-1).trim():t}(e.replace(/`/g,"").trim())}function S(e){const t=w(e);if(!t)return"";const s=t.indexOf("$");return(s>=0?t.slice(0,s):t).trim()}function L(){if(!a.playlistList||!a.playlistEmpty)return;const e=E();if(a.playlistList.innerHTML="",!e.items.length)return a.playlistList.appendChild(a.playlistEmpty),void(a.playlistEmpty.style.display="block");a.playlistEmpty.style.display="none";const t=document.createDocumentFragment();e.items.forEach(e=>{const s=document.createElement("div");s.className="playlist-item";const n=h(e.title||e.url),o=h(e.rawUrl||e.url),r=h(e.url),l=e.group?`<div class="playlist-item-meta">${h(e.group)}</div>`:"";s.innerHTML=`\n            <div class="playlist-item-content">\n                <div class="playlist-item-title">${n}</div>\n                ${l}\n                <div class="playlist-item-url" title="${o}">${o.length>80?`${o.slice(0,80)}...`:o}</div>\n            </div>\n            <div class="playlist-item-actions">\n                <button class="playlist-item-play" title="播放" data-url="${r}">\n                    <i class="fas fa-play"></i>\n                </button>\n            </div>\n        `,t.appendChild(s)}),a.playlistList.appendChild(t),a.playlistList&&(a.playlistList.removeEventListener("click",I),a.playlistList.addEventListener("click",I))}function I(e){const t=e.target.closest(".playlist-item-play");if(!t)return;const s=t.dataset.url;s&&(a.urlInput.value=s,J(s),C())}function b(){a.playlistModal&&(a.playlistModal.classList.add("show"),L())}function C(){a.playlistModal&&a.playlistModal.classList.remove("show")}function T(e){const t=function(e){const t=("string"==typeof e?e.replace(/\r\n?/g,"\n"):"").split("\n"),s=[],n=new Set;let o=null;for(const a of t){const e=w(a);if(!e)continue;if(e.startsWith("#EXTM3U")){(e.match(/https?:\/\/[^\s",]+/g)||[]).forEach(e=>n.add(e));continue}if(e.startsWith("#EXTINF")){const t={};e.replace(/([a-zA-Z0-9_-]+)\s*=\s*"([^"]*)"/g,(e,s,n)=>(t[s]=n,""));const s=e.lastIndexOf(","),n=s>=0?e.slice(s+1).trim():"";o={attrs:t,displayName:n};continue}if(e.startsWith("#"))continue;const t=S(e);if(!t)continue;const r={title:o?.displayName||o?.attrs?.["tvg-name"]||t,url:t,rawUrl:w(e),group:o?.attrs?.["group-title"]||"",logo:o?.attrs?.["tvg-logo"]||"",tvgId:o?.attrs?.["tvg-id"]||"",tvgName:o?.attrs?.["tvg-name"]||""};s.push(r),o=null}const r=[],l=new Set;for(const a of s)a?.url&&"string"==typeof a.url&&v(a.url)&&(l.has(a.url)||(l.add(a.url),r.push(a)));return{epgUrls:Array.from(n),items:r}}(e),s=E().items.length,n=function(e){const t=E(),s=new Set(t.items.map(e=>e?.url).filter(Boolean));for(const o of e.items||[])o?.url&&!s.has(o.url)&&(t.items.push(o),s.add(o.url));const n=new Set(t.epgUrls);for(const o of e.epgUrls||[])"string"==typeof o&&o&&n.add(o);return t.epgUrls=Array.from(n),B(t),t}(t),o=n.items.length-s;L(),M("zh-CN"===p?`播放列表导入完成：新增 ${o} 条，共 ${n.items.length} 条`:`Playlist imported: +${o}, total ${n.items.length}`,"success")}function x(e){const t=function(e){if(!e)return!1;const t=E(),s=t.items.findIndex(t=>t?.url===e);return!(s<0||(t.items.splice(s,1),B(t),a.playlistModal?.classList.contains("show")&&L(),0))}(e);t&&M("zh-CN"===p?"播放失败，已从导入列表移除该地址":"Playback failed, removed from imported list","error")}function P(e){p=e,localStorage.setItem("playerLang",e);const t=i18n[e];a.pageTitle&&(a.pageTitle.textContent=t.pageTitle),a.langLabel&&(a.langLabel.textContent=t.langLabel),a.themeLabel&&(a.themeLabel.textContent=t.themeLabel),a.speedLabel&&(a.speedLabel.textContent=t.speedLabel),a.qualityLabel&&(a.qualityLabel.textContent=t.qualityLabel),a.alignLabel&&(a.alignLabel.textContent=t.alignLabel),a.loadPlayText&&(a.loadPlayText.textContent=t.loadPlayBtn);const s=(e,t,s)=>{e&&(e.innerHTML=`<i class="${t}"></i> <span>${h(s)}</span>`)};s(a.pauseBtn,"fas fa-pause",t.pauseBtn),s(a.fullscreenBtn,"fas fa-expand",t.fullscreenBtn),s(a.pipBtn,"fas fa-expand-arrows-alt",t.pipBtn),s(a.screenshotBtn,"fas fa-camera",t.screenshotBtn),s(a.shortcutBtn,"fas fa-keyboard",t.shortcutBtn),s(a.clearCacheBtn,"fas fa-trash",t.clearCacheBtn),s(a.historyBtn,"fas fa-history",t.historyBtn),s(a.playlistBtn,"fas fa-list",t.playlistBtn),a.urlInput&&(a.urlInput.placeholder=t.urlInputPlaceholder),a.shortcutTitle&&(a.shortcutTitle.textContent=t.shortcutTitle),a.historyTitle&&(a.historyTitle.textContent=t.historyTitle),a.historyClear&&(a.historyClear.textContent=t.clearHistoryBtn),a.shortcutPlay&&(a.shortcutPlay.textContent=t.shortcutPlay),a.shortcutForward&&(a.shortcutForward.textContent=t.shortcutForward),a.shortcutBackward&&(a.shortcutBackward.textContent=t.shortcutBackward),a.shortcutVolUp&&(a.shortcutVolUp.textContent=t.shortcutVolUp),a.shortcutVolDown&&(a.shortcutVolDown.textContent=t.shortcutVolDown),a.shortcutFullscreen&&(a.shortcutFullscreen.textContent=t.shortcutFullscreen),a.shortcutPip&&(a.shortcutPip.textContent=t.shortcutPip),a.shortcutScreenshot&&(a.shortcutScreenshot.textContent=t.shortcutScreenshot),a.touchTip&&(a.touchTip.textContent=t.touchTip),a.logTitle&&(a.logTitle.textContent=t.logTitle),a.screenshotDownload&&(a.screenshotDownload.textContent=t.screenshotDownload),a.playlistModalTitle&&(a.playlistModalTitle.textContent=t.playlistModalTitle),a.playlistFileBtnText&&(a.playlistFileBtnText.textContent=t.playlistFileBtn),a.playlistImportBtnText&&(a.playlistImportBtnText.textContent=t.playlistImportBtn),a.playlistClearBtnText&&(a.playlistClearBtnText.textContent=t.playlistClearBtn),a.playlistTextarea&&(a.playlistTextarea.placeholder=t.playlistTextareaPlaceholder),a.playlistEmpty&&(a.playlistEmpty.textContent=t.playlistEmpty),N(0,"info")}function k(e){document.body.className=e,localStorage.setItem("playerTheme",e),N(0,"info")}function N(e,t="info"){const s=new Date;s.getHours().toString().padStart(2,"0"),s.getMinutes().toString().padStart(2,"0"),s.getSeconds().toString().padStart(2,"0")}function M(e,t,s={}){if("string"!=typeof e)return;if(!a.statusTip)return;const{duration:n=3e3,keepVisible:o=!1,logLevel:r=("error"===t?"error":"success")}=s;a.statusTip.textContent=e,a.statusTip.className=`status-tip show ${t}`,N(0,r),o||(window.statusTipTimer&&clearTimeout(window.statusTipTimer),window.statusTipTimer=setTimeout(()=>{a.statusTip.classList.remove("show")},n))}function R(e=i18n[p].loadingText){c=!0,a.loadingMask&&a.loadingText&&(a.loadingMask.classList.add("show"),a.loadingText.textContent=e,M(e,"loading",{keepVisible:!0,logLevel:"info"}),N(0,"info"))}function U(){c=!1,a.loadingMask&&a.loadingMask.classList.remove("show"),a.statusTip&&a.statusTip.classList.remove("show"),N(0,"info")}function F(){const e=i18n[p].confirmClearCache||"确定要清理所有播放器设置缓存吗？这将删除您的现有设定，只保留播放记录。";confirm(e)?(localStorage.removeItem("playerPreferredSpeed"),localStorage.removeItem("playerTheme"),localStorage.removeItem("playerLang"),localStorage.removeItem("playerVolume"),localStorage.removeItem("playerMuted"),localStorage.removeItem("playerQuality"),localStorage.removeItem("historySortMode"),localStorage.removeItem("playerAlignment"),localStorage.removeItem("helpModalShown"),localStorage.removeItem("lastPlayedVideoUrl"),a.urlInput&&(a.urlInput.value=""),a.speedSelect.value="1",a.video.playbackRate=1,a.langSelect.value="zh-CN",a.volumeSlider.value=.5,a.video.volume=.5,a.video.muted=!1,Y(),P("zh-CN"),document.body.classList.remove("player-align-left","player-align-center","player-align-right"),document.body.classList.add("player-align-center"),a.alignLeftBtn&&a.alignLeftBtn.classList.remove("active"),a.alignCenterBtn&&a.alignCenterBtn.classList.add("active"),a.alignRightBtn&&a.alignRightBtn.classList.remove("active"),a.sortRecentBtn&&a.sortHotBtn&&(a.sortRecentBtn.classList.add("active"),a.sortHotBtn.classList.remove("active")),M(i18n[p].statusSuccessClearCache,"success"),N(0,"success")):N(0,"info")}function D(e){localStorage.setItem("playerPreferredSpeed",e),N(0,"info")}function $(){try{if(!a.video.src||0===a.video.videoWidth||0===a.video.videoHeight)return void M(i18n[p].statusErrorScreenshot.replace("{msg}","视频未加载或无效"),"error");const e=document.createElement("canvas");e.width=a.video.videoWidth,e.height=a.video.videoHeight,e.getContext("2d").drawImage(a.video,0,0,e.width,e.height);const t=e.toDataURL("image/png");a.screenshotImg.src=t,a.screenshotModal.classList.add("show"),a.screenshotDownload.onclick=()=>{const e=document.createElement("a");e.href=t;const s=(new Date).toISOString().replace(/[:.]/g,"-"),n="zh-CN"===p?`视频截图_${s}.png`:`Video_Screenshot_${s}.png`;e.download=n,e.click(),M(i18n[p].statusSuccessScreenshotDownload,"success")},M(i18n[p].statusSuccessScreenshot,"success")}catch(e){e.message.includes("Not allowed to load local resource")||e.message.includes("blob:")?M(i18n[p].statusErrorScreenshot.replace("{msg}","浏览器安全限制，无法生成截图"),"error"):M(i18n[p].statusErrorScreenshot.replace("{msg}",e.message),"error")}}function V(){document.pictureInPictureElement?document.exitPictureInPicture().then(()=>{const e=a.pipBtn.querySelector("span");e&&(e.textContent="zh-CN"===p?"画中画":"PiP"),M(i18n[p].statusSuccessExitPip,"success")}).catch(e=>{M(i18n[p].statusErrorPip.replace("{action}","zh-CN"===p?"退出":"Exit ").replace("{msg}",e.message),"error")}):a.video.requestPictureInPicture().then(()=>{const e=a.pipBtn.querySelector("span");e&&(e.textContent="zh-CN"===p?"退出画中画":"Exit PiP"),M(i18n[p].statusSuccessPip,"success")}).catch(e=>{M(i18n[p].statusErrorPip.replace("{action}","zh-CN"===p?"进入":"Enter ").replace("{msg}",e.message),"error")})}function q(){if(document.fullscreenElement){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen();const e=a.fullscreenBtn.querySelector("span");e&&(e.textContent="zh-CN"===p?"全屏":"Fullscreen"),M(i18n[p].statusSuccessExitFullscreen,"success")}else{a.video.requestFullscreen?a.video.requestFullscreen():a.video.webkitRequestFullscreen?a.video.webkitRequestFullscreen():a.video.msRequestFullscreen&&a.video.msRequestFullscreen();const e=a.fullscreenBtn.querySelector("span");e&&(e.textContent="zh-CN"===p?"退出全屏":"Exit Fullscreen"),M(i18n[p].statusSuccessFullscreen,"success")}}function z(){navigator.onLine?(a.statusTip.classList.remove("show"),d&&a.video.paused&&(u=setInterval(()=>{c||(R(i18n[p].statusReconnect),J(d,!0))},3e3)),N(0,"info")):(M(i18n[p].statusOffline,"offline"),a.video.pause(),u&&clearInterval(u),N(0,"error"))}async function O(e,t=0){try{if("string"!=typeof e)throw new TypeError("URL必须是字符串类型");if(!e)return;if(!v(e))return void N(0,"warn");if("number"!=typeof t||isNaN(t))throw new TypeError("播放时间必须是数字类型");y&&clearTimeout(y),y=setTimeout(async()=>{try{const s=g();if(!s)return;const n=await s.getRecord(e),o={url:e,title:n?n.title:e.split("/").pop().split("?")[0]||"未命名视频",time:Math.round(t),duration:Math.round(a.video.duration||n?.duration||0),date:(new Date).toISOString(),playCount:(n?.playCount||0)+1};await s.saveRecord(o),N(0,"info"),await A()}catch(s){N(s.message,"error")}},2e3)}catch(s){N(s.message,"error")}}async function H(e="date",t="desc"){try{const s=g();return s?await s.getAllRecords({sortBy:e,sortOrder:t}):[]}catch(s){return[]}}async function A(e=null){const t=e||localStorage.getItem("historySortMode")||"recent";let s,n;localStorage.setItem("historySortMode",t),"hot"===t?(s="playCount",n="desc"):(s="date",n="desc"),a.sortRecentBtn&&a.sortHotBtn&&(a.sortRecentBtn.classList.toggle("active","recent"===t),a.sortHotBtn.classList.toggle("active","hot"===t));const o=await H(s,n),r=a.historyBody,l=a.historyEmpty;if(r.innerHTML="",0===o.length)r.appendChild(l),l.style.display="block";else{l.style.display="none";const e=document.createDocumentFragment();o.forEach(t=>{const s=document.createElement("div"),n=d===t.url;s.className="history-item "+(n?"current-playing":"");const o=new Date(t.date).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),r=t.duration>0?Math.round(t.time/t.duration*100):0;s.innerHTML=`\n                <div class="history-item-content">\n                    <div class="history-item-title-container">\n                        <span class="history-item-title" data-url="${h(t.url)}">${h(t.title)}</span>\n                        <button class="history-item-edit" title="编辑名称" data-url="${h(t.url)}">\n                            <i class="fas fa-edit"></i>\n                        </button>\n                    </div>\n                    <div class="history-item-meta">\n                        <span class="history-item-date">${o}</span>\n                        ${t.duration>0?`<span class="history-item-time">播放进度：${_(t.time)} / ${_(t.duration)} (${r}%)</span>`:""}\n                        <span class="history-item-playcount"><i class="fas fa-fire" style="color: #ff9800; margin-right: 4px;"></i>${t.playCount||1}次播放</span>\n                    </div>\n                    <div class="history-item-url" title="${h(t.url)}">${h(t.url.length>50?`${t.url.substring(0,50)}...`:t.url)}</div>\n                </div>\n                <div class="history-item-actions">\n                    <button class="history-item-play" title="播放" data-url="${h(t.url)}">\n                        <i class="fas fa-play"></i>\n                    </button>\n                    <button class="history-item-delete" title="删除" data-url="${h(t.url)}">\n                        <i class="fas fa-trash"></i>\n                    </button>\n                </div>\n            `,e.appendChild(s)}),r.appendChild(e)}!function(){const e=a.historyBody;e.removeEventListener("click",j),e.addEventListener("click",j)}()}function j(e){const t=e.target;if(t.closest(".history-item-play")){const e=t.closest(".history-item-play").dataset.url;a.urlInput.value=e,J(e)}else t.closest(".history-item-delete")?async function(e){try{const t=g();if(!t)return;await t.deleteRecord(e),await A(),N(0,"info")}catch(t){M("删除播放历史失败","error")}}(t.closest(".history-item-delete").dataset.url):t.closest(".history-item-edit")&&async function(e){try{const t=g();if(!t)return;const s=await t.getRecord(e);if(!s)return;const n=prompt("请输入新的名称：",s.title);null!==n&&""!==n.trim()&&(s.title=n.trim(),await t.saveRecord(s),await A(),N(0,"info"))}catch(t){M("编辑播放历史失败","error")}}(t.closest(".history-item-edit").dataset.url)}async function W(){try{const e=await H(),t=JSON.stringify(e,null,2),s=new Blob([t],{type:"application/json"}),n=URL.createObjectURL(s),o=document.createElement("a");o.href=n,o.download=`video-play-history-${(new Date).toISOString().slice(0,10)}.json`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(n),N(0,"info"),M("播放历史导出成功","success")}catch(e){M("导出播放历史失败","error")}}function _(e){if(!e||isNaN(e))return"00:00";const t=Math.floor(e/60),s=Math.floor(e%60);return`${t.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`}function X(e,t){!e||t<5||(O(e,t),N(Math.round(t),"info"))}async function Q(e){try{return 0}catch(t){return 0}}async function J(e,t=!1){try{if("string"!=typeof e)throw new TypeError("URL必须是字符串类型");if(!e||!e.trim())return void M(i18n[p].statusErrorUrl,"error");const o=e.trim();if(!function(e){return!!v(e)&&([".m3u8",".mp4",".webm",".ogg",".avi",".mov",".wmv"].some(t=>e.toLowerCase().includes(t))||/\/playlist\.m3u8/i.test(e))}(o))return M("错误：请输入有效的视频URL（支持m3u8、mp4、webm、ogg、avi、mov、wmv格式）","error"),void N(0,"error");if(d=o,localStorage.setItem("lastPlayedVideoUrl",o),N(0,"info"),U(),i&&(i.destroy(),i=null,N(0,"info")),a.video.pause(),a.video.src&&(a.video.src="",a.video.mediaSource))try{a.video.mediaSource.endOfStream()}catch(s){}if(a.fullscreenBtn.disabled=!0,a.pipBtn.disabled=!0,a.screenshotBtn.disabled=!0,a.qualitySelect.disabled=!0,a.progressBar.style.width="0%",a.progressLoaded.style.width="0%",u&&(clearInterval(u),u=null),R(i18n[p].loadingText),e.toLowerCase().includes(".m3u8"))try{l||await async function(){if(!l)try{const e=document.createElement("script");e.src="https://cdn.jsdelivr.net/npm/hls.js@latest",e.async=!0,await new Promise((t,s)=>{e.onload=t,e.onerror=s,document.head.appendChild(e)}),r=window.Hls,l=!0}catch(e){throw e}}(),r.isSupported()?(i=new r({maxBufferLength:30,startLevel:-1,enableWorker:!0,lowLatencyMode:!0}),i.attachMedia(a.video),i.on(r.Events.MANIFEST_PARSED,async()=>{if(U(),function(e){if(!e||!e.levels||0===e.levels.length)return a.qualitySelect.disabled=!0,void(a.qualitySelect.innerHTML='<option value="">自动</option>');a.qualitySelect.innerHTML='<option value="">自动</option>',a.qualitySelect.disabled=!1,e.levels.forEach((e,t)=>{const s=Math.round(e.bitrate/1e3),n=`${e.width||"Unknown"}x${e.height||"Unknown"} (${s}kbps)`,o=document.createElement("option");o.value=t,o.textContent=n,a.qualitySelect.appendChild(o)});const t=localStorage.getItem("playerQuality");t&&(a.qualitySelect.value=t,e.currentLevel=""===t?-1:Number(t)),a.qualitySelect.addEventListener("change",()=>{const t=a.qualitySelect.value;e.currentLevel=""===t?-1:Number(t),localStorage.setItem("playerQuality",t);const s=""===t?"zh-CN"===p?"自动":"Auto":a.qualitySelect.options[a.qualitySelect.selectedIndex].text;M(i18n[p].statusSuccessQuality.replace("{quality}",s),"success")})}(i),t){const e=await Q();e>0&&(a.video.currentTime=e)}M(i18n[p].statusSuccessLoad,"success"),a.fullscreenBtn.disabled=!1,a.pipBtn.disabled=!("pictureInPictureEnabled"in document),a.screenshotBtn.disabled=!1,await O(e),a.video.play().catch(e=>{})}),i.on(r.Events.LOADING_PROGRESS,(e,t)=>{const s=t.loaded/t.total*100;a.progressLoaded.style.width=`${s}%`}),i.on(r.Events.ERROR,(e,t)=>{U();let s=i18n[p].statusErrorLoad;if(t.fatal)switch(t.type){case r.ErrorTypes.NETWORK_ERROR:s=i18n[p].statusErrorNetwork,i.startLoad();break;case r.ErrorTypes.MEDIA_ERROR:s=i18n[p].statusErrorDecode,i.recoverMediaError();break;default:s=i18n[p].statusErrorUnknown.replace("{msg}",t.details),x(d),i.destroy(),i=null,a.video.src="",a.fullscreenBtn.disabled=!0,a.pipBtn.disabled=!0,a.screenshotBtn.disabled=!0}M(s,"error")}),i.loadSource(e)):a.video.canPlayType("application/vnd.apple.mpegurl")?(a.video.src=e,a.video.addEventListener("loadedmetadata",async()=>{if(U(),t){const e=await Q();e>0&&(a.video.currentTime=e)}M(i18n[p].statusSuccessLoadNative,"success"),a.fullscreenBtn.disabled=!1,a.pipBtn.disabled=!("pictureInPictureEnabled"in document),a.screenshotBtn.disabled=!1,await O(e),a.video.play().catch(e=>{})},{once:!0}),a.video.addEventListener("error",e=>{U();const t="zh-CN"===p?"视频加载失败：无法播放此格式":"Video load failed: Format not supported";M(i18n[p].statusErrorVideo.replace("{msg}",t),"error"),x(d)},{once:!0})):(U(),M(i18n[p].statusErrorUnknown.replace("{msg}","当前浏览器不支持播放 m3u8 格式"),"error"),a.video.src="")}catch(n){U(),M(i18n[p].statusErrorUnknown.replace("{msg}","hls.js 加载失败"),"error"),N(n.message,"error")}else a.video.src=e,a.video.addEventListener("loadedmetadata",async()=>{if(U(),t){const e=await Q();e>0&&(a.video.currentTime=e)}M(i18n[p].statusSuccessLoad,"success"),a.fullscreenBtn.disabled=!1,a.pipBtn.disabled=!("pictureInPictureEnabled"in document),a.screenshotBtn.disabled=!1,await O(e),a.video.play().catch(e=>{})},{once:!0}),a.video.addEventListener("error",e=>{U();let t="";const s=a.video.error;if(s){const e={1:"zh-CN"===p?"视频加载被中止":"Video load aborted",2:"zh-CN"===p?"网络请求失败":"Network request failed",3:"zh-CN"===p?"视频解码失败":"Video decoding failed",4:"zh-CN"===p?"视频格式不支持":"Video format not supported",5:"zh-CN"===p?"视频加载超时":"Video load timeout"};t=s.message&&s.message.includes("has no supported sources")?"zh-CN"===p?"视频没有有效的源":"The video has no supported sources":e[s.code]||s.message||"Unknown error"}else t="zh-CN"===p?"视频加载失败":"Video load failed";M(i18n[p].statusErrorVideo.replace("{msg}",t),"error"),x(d)},{once:!0})}catch(n){U(),M(`视频加载异常：${n.message||"未知错误"}`,"error"),N(n.message,"error")}}async function K(e){const t=document.getElementById("history-body");if(document.getElementById("history-empty"),"default"===e)return await A(),void N(0,"info");t.innerHTML="";const s=await async function(e){return new Promise((t,s)=>{const n=indexedDB.open("PlaylistDB",1);n.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains("playlists")||t.createObjectStore("playlists",{keyPath:"id"})},n.onsuccess=n=>{const o=n.target.result,r=o.transaction("playlists","readonly").objectStore("playlists").get(e);r.onsuccess=e=>{const s=e.target.result,n=s?s.history:[];t(n),o.close()},r.onerror=e=>{s(e.target.error),o.close()}},n.onerror=e=>{s(e.target.error)}})}(e);if(0===s.length){const e=document.createElement("div");e.className="history-empty",e.textContent="暂无播放历史",t.appendChild(e)}else s.forEach(e=>{const s=document.createElement("div");s.className="history-item",s.innerHTML=`\n                <div class="history-item-title">${e.title||e.url}</div>\n                <div class="history-item-time">${new Date(e.lastPlayed).toLocaleString()}</div>\n                <button class="history-item-play" data-url="${e.url}">播放</button>\n            `,t.appendChild(s)}),document.querySelectorAll(".history-item-play").forEach(e=>{e.addEventListener("click",()=>{J(e.getAttribute("data-url"))})});N(0,"info")}function Y(){const e=a.video.volume,t=a.volumeIcon;a.video.muted||0===e?t.className="fas fa-volume-mute":t.className=e<.5?"fas fa-volume-down":"fas fa-volume-up"}function G(){a.centerPlayBtn&&(a.video.paused||a.video.ended?a.centerPlayBtn.classList.remove("hide"):a.centerPlayBtn.classList.add("hide"))}function Z(){function e(){a.urlInput.value.trim()?a.urlClearBtn.classList.add("visible"):a.urlClearBtn.classList.remove("visible")}a.video.addEventListener("play",()=>{G(),M(i18n[p].statusSuccessPlay,"success")}),a.video.addEventListener("pause",()=>{X(d,a.video.currentTime),G(),M(i18n[p].statusSuccessPause,"success")}),a.video.addEventListener("ended",()=>{X(d,0),G(),M(i18n[p].statusSuccessEnd,"success")}),a.centerPlayBtn.addEventListener("click",()=>{if(c)return;const e=a.urlInput.value.trim();e?d!==e?J(e):a.video.paused||a.video.ended?a.video.play().catch(e=>{M(i18n[p].statusErrorUnknown.replace("{msg}",e.message),"error")}):a.video.pause():M(i18n[p].statusErrorUrl,"error")}),a.fullscreenBtn.addEventListener("click",q),document.addEventListener("fullscreenchange",()=>{const e=a.fullscreenBtn.querySelector("span");e&&(e.textContent=document.fullscreenElement?"zh-CN"===p?"退出全屏":"Exit Fullscreen":"zh-CN"===p?"全屏":"Fullscreen")}),document.addEventListener("webkitfullscreenchange",()=>{const e=a.fullscreenBtn.querySelector("span");e&&(e.textContent=document.webkitFullscreenElement?"zh-CN"===p?"退出全屏":"Exit Fullscreen":"zh-CN"===p?"全屏":"Fullscreen")}),a.pipBtn.addEventListener("click",V),a.video.addEventListener("enterpictureinpicture",()=>{const e=a.pipBtn.querySelector("span");e&&(e.textContent="zh-CN"===p?"退出画中画":"Exit PiP")}),a.video.addEventListener("leavepictureinpicture",()=>{const e=a.pipBtn.querySelector("span");e&&(e.textContent="zh-CN"===p?"画中画":"PiP")}),a.screenshotBtn.addEventListener("click",$),a.screenshotClose.addEventListener("click",()=>{a.screenshotModal.classList.remove("show"),a.screenshotImg.src=""}),a.screenshotModal.addEventListener("click",e=>{e.target===a.screenshotModal&&(a.screenshotModal.classList.remove("show"),a.screenshotImg.src="")}),a.volumeSlider.addEventListener("input",()=>{a.video.volume=a.volumeSlider.value,a.video.muted=0==a.volumeSlider.value,localStorage.setItem("playerVolume",a.volumeSlider.value),localStorage.setItem("playerMuted",a.video.muted),Y()}),a.volumeIcon.addEventListener("click",()=>{a.video.muted=!a.video.muted,a.video.muted?a.volumeSlider.value=0:(a.volumeSlider.value=localStorage.getItem("playerVolume")||.5,a.video.volume=a.volumeSlider.value),localStorage.setItem("playerVolume",a.volumeSlider.value),localStorage.setItem("playerMuted",a.video.muted),Y()}),a.speedSelect.addEventListener("change",()=>{const e=a.speedSelect.value;a.video.playbackRate=e,D(e),M(i18n[p].statusSuccessSpeed.replace("{speed}",e),"success")}),a.video.addEventListener("timeupdate",()=>{if(!a.video.duration)return;const e=a.video.currentTime/a.video.duration*100;a.progressBar.style.width=`${e}%`,G()}),a.video.addEventListener("progress",()=>{if(0===a.video.buffered.length)return;const e=a.video.buffered.end(a.video.buffered.length-1)/a.video.duration*100;a.progressLoaded.style.width=`${e}%`}),a.progressWrap.addEventListener("click",e=>{if(!a.video.duration)return;const t=a.progressWrap.getBoundingClientRect(),s=(e.clientX-t.left)/t.width;a.video.currentTime=s*a.video.duration,a.progressBar.style.width=100*s+"%"}),a.video.addEventListener("ended",()=>{X(d,0),M(i18n[p].statusSuccessEnd,"success")}),a.urlInput.addEventListener("keydown",e=>{if("Enter"===e.key){const e=a.urlInput.value.trim();e?J(e):M(i18n[p].statusErrorUrl,"error")}}),e(),a.urlInput.addEventListener("input",e),a.urlInput.addEventListener("focus",e),a.urlInput.addEventListener("blur",e),a.urlClearBtn.addEventListener("click",()=>{a.urlInput.value="",e(),a.urlInput.focus()}),a.langSelect.addEventListener("change",e=>{P(e.target.value)}),a.themeSelect.addEventListener("change",e=>{k(e.target.value)}),a.clearCacheBtn.addEventListener("click",F),window.addEventListener("online",z),window.addEventListener("offline",z),a.helpBtn&&a.helpModal&&a.helpClose&&(a.helpBtn.addEventListener("click",()=>{a.helpModal.classList.add("show"),N(0,"info")}),a.helpClose.addEventListener("click",ee),a.helpModal.addEventListener("click",e=>{e.target===a.helpModal&&ee()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&a.helpModal.classList.contains("show")&&ee()})),a.playlistBtn&&a.playlistModal&&a.playlistClose&&(a.playlistBtn.addEventListener("click",()=>{b(),N(0,"info")}),a.playlistClose.addEventListener("click",C),a.playlistModal.addEventListener("click",e=>{e.target===a.playlistModal&&C()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&a.playlistModal.classList.contains("show")&&C()}),a.playlistFileBtn&&a.playlistFileInput&&(a.playlistFileBtn.addEventListener("click",()=>{a.playlistFileInput.click()}),a.playlistFileInput.addEventListener("change",async e=>{const t=e.target.files[0];if(t)try{const e=await function(e){return new Promise((t,s)=>{const n=new FileReader;n.onload=e=>t(e.target.result),n.onerror=e=>s(e.target.error||new Error("read file failed")),n.readAsText(e)})}(t);a.playlistTextarea&&(a.playlistTextarea.value=e),T(e)}catch(s){const e=s?.message||String(s);M("zh-CN"===p?`读取文件失败：${e}`:`Failed to read file: ${e}`,"error")}finally{e.target.value=""}})),a.playlistImportBtn&&a.playlistTextarea&&a.playlistImportBtn.addEventListener("click",()=>{const e=a.playlistTextarea.value||"";e.trim()?T(e):M("zh-CN"===p?"请先粘贴 M3U 内容":"Please paste M3U content first","error")}),a.playlistClearBtn&&a.playlistClearBtn.addEventListener("click",()=>{B({epgUrls:[],items:[]}),L(),M("zh-CN"===p?"播放列表已清空":"Playlist cleared","success")})),a.historySidebarToggle&&a.sidebar&&a.historySidebarToggle.addEventListener("click",async()=>{a.sidebar.classList.toggle("hidden"),!a.sidebar.classList.contains("hidden")&&a.historyBody&&a.historyBody.classList.add("show"),await A(),N(0,"info")}),a.historyExport&&a.historyExport.addEventListener("click",W);const t=document.getElementById("playlist-import"),s=document.getElementById("playlist-export"),n=document.getElementById("playlist-select");t&&t.addEventListener("click",()=>{b()}),s&&s.addEventListener("click",async()=>{await async function(){const e=g();if(!e)return void M("zh-CN"===p?"播放历史不可用，无法导出":"Play history unavailable","error");const t=await e.getAllRecords({sortBy:"date",sortOrder:"desc",limit:1e4});if(!t.length)return void M("zh-CN"===p?"播放历史为空，无法导出":"Play history is empty","error");const s=["#EXTM3U"];for(const a of t){const e=String(a?.title?a.title:a?.url||""),t=a?.url?String(a.url):"";t&&(s.push(`#EXTINF:-1,${e}`),s.push(t))}const n=s.join("\n")+"\n",o=new Blob([n],{type:"audio/x-mpegurl;charset=utf-8"}),r=URL.createObjectURL(o),l=document.createElement("a");l.href=r,l.download=`play-history-${(new Date).toISOString().slice(0,10)}.m3u`,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(r),M("zh-CN"===p?"已导出播放历史为 M3U":"Exported play history as M3U","success")}()}),n&&n.addEventListener("change",async()=>{const e=n.value;await K(e),N(0,"info")});const o=document.getElementById("resize-handle"),r=document.getElementById("sidebar"),l=document.querySelector(".player-area");if(o&&r&&l){let e=!1,t=0,s=0;o.addEventListener("mousedown",n=>{e=!0,t=n.clientX,s=parseInt(document.defaultView.getComputedStyle(r).width,10),document.body.style.cursor="ew-resize",document.body.style.userSelect="none",document.body.classList.add("resizing"),n.preventDefault()}),document.addEventListener("mousemove",n=>{if(!e)return;const a=n.clientX-t,i=s+a;i<200||i>window.innerWidth/2||(r.style.width=`${i}px`,l.style.width=window.innerWidth-i-5+"px",o.style.left=`${i}px`,l.style.marginLeft=`${i+5}px`)}),document.addEventListener("mouseup",()=>{e=!1,document.body.style.cursor="",document.body.style.userSelect="",document.body.classList.remove("resizing")})}function i(e){document.body.classList.remove("player-align-left","player-align-center","player-align-right"),document.body.classList.add(`player-align-${e}`),a.alignLeftBtn&&a.alignLeftBtn.classList.remove("active"),a.alignCenterBtn&&a.alignCenterBtn.classList.remove("active"),a.alignRightBtn&&a.alignRightBtn.classList.remove("active"),"left"===e&&a.alignLeftBtn?a.alignLeftBtn.classList.add("active"):"center"===e&&a.alignCenterBtn?a.alignCenterBtn.classList.add("active"):"right"===e&&a.alignRightBtn&&a.alignRightBtn.classList.add("active"),localStorage.setItem("playerAlignment",e),N(0,"info")}(JSON.parse(localStorage.getItem("playlists"))||[]).forEach(e=>{const t=document.createElement("option");t.value=e.id,t.textContent=e.name,n.appendChild(t)}),A(),G(),a.video.addEventListener("click",()=>{c||(a.video.paused||a.video.ended?a.video.play().catch(e=>{M(i18n[p].statusErrorUnknown.replace("{msg}",e.message),"error")}):a.video.pause())}),a.alignLeftBtn&&a.alignLeftBtn.addEventListener("click",()=>{i("left")}),a.alignCenterBtn&&a.alignCenterBtn.addEventListener("click",()=>{i("center")}),a.alignRightBtn&&a.alignRightBtn.addEventListener("click",()=>{i("right")}),i(localStorage.getItem("playerAlignment")||"center"),window.addEventListener("beforeunload",()=>{d&&(X(d,a.video.currentTime),O(d,a.video.currentTime)),D(a.video.playbackRate),N(0,"info")}),a.video&&a.video.addEventListener("ended",()=>{d&&O(d,a.video.duration)})}function ee(){a.helpModal&&(a.helpModal.classList.remove("show"),localStorage.setItem("helpModalShown","true"),N(0,"info"))}window.onload=async()=>{N(0,"info");const e=localStorage.getItem("playerTheme")||"light";a.themeSelect.value=e,k(e),a.langSelect&&(a.langSelect.value=p),P(p);const t=function(){const e=localStorage.getItem("playerPreferredSpeed")||"1";return N(0,"info"),e}();a.speedSelect.value=t,a.video.playbackRate=t;const s=localStorage.getItem("playerVolume"),n="true"===localStorage.getItem("playerMuted");s?(a.volumeSlider.value=s,a.video.volume=s):(a.volumeSlider.value=.5,a.video.volume=.5),a.video.muted=n,Y(),document.addEventListener("keydown",e=>{if(document.activeElement!==a.urlInput)switch(e.key.toLowerCase()){case" ":e.preventDefault(),a.video.paused&&!c?a.video.play().then(()=>{M(i18n[p].statusSuccessPlay,"success")}).catch(e=>{M(i18n[p].statusErrorUnknown.replace("{msg}",e.message),"error")}):a.video.pause();break;case"arrowright":e.preventDefault(),a.video.currentTime=Math.min(a.video.currentTime+5,a.video.duration),a.progressBar.style.width=a.video.currentTime/a.video.duration*100+"%";break;case"arrowleft":e.preventDefault(),a.video.currentTime=Math.max(a.video.currentTime-5,0),a.progressBar.style.width=a.video.currentTime/a.video.duration*100+"%";break;case"arrowup":e.preventDefault();const t=Math.min(Number(a.video.volume)+.05,1);a.video.volume=t,a.volumeSlider.value=t;break;case"arrowdown":e.preventDefault();const s=Math.max(Number(a.video.volume)-.05,0);a.video.volume=s,a.volumeSlider.value=s;break;case"f":e.preventDefault(),q();break;case"p":e.preventDefault(),V();break;case"s":e.preventDefault(),$()}}),N(0,"info"),function(){let e=0;a.video.addEventListener("touchstart",t=>{const s=Date.now();s-e<300&&(t.preventDefault(),a.video.paused&&!c?a.video.play().then(()=>{M(i18n[p].statusSuccessPlay,"success")}).catch(e=>{M(i18n[p].statusErrorUnknown.replace("{msg}",e.message),"error")}):a.video.pause(),a.touchTip.classList.add("show"),clearTimeout(m),m=setTimeout(()=>{a.touchTip.classList.remove("show")},1e3)),e=s});let t=0,s=0;a.video.addEventListener("touchmove",e=>{if(1!==e.touches.length)return;const n=e.touches[0];if(0===t)return t=n.clientX,void(s=n.clientY);const o=n.clientX-t,r=n.clientY-s;if(Math.abs(o)>Math.abs(r)){e.preventDefault();const t=o/a.video.offsetWidth*a.video.duration;a.video.currentTime=Math.max(0,Math.min(a.video.currentTime+t,a.video.duration)),a.progressBar.style.width=a.video.currentTime/a.video.duration*100+"%"}else{e.preventDefault();const t=-r/a.video.offsetHeight,s=Math.max(0,Math.min(a.video.volume+t,1));a.video.volume=s,a.volumeSlider.value=s}t=n.clientX,s=n.clientY}),a.video.addEventListener("touchend",()=>{t=0,s=0}),N(0,"info")}(),Z();const o=new URLSearchParams(window.location.search).get("url");let r="";"/play"===window.location.pathname?o?(r=o,a.urlInput.value=r):r=a.urlInput.value.trim():o?(r=o.startsWith("web+video://")?o.replace(/^web\+video:\/\//,"https://"):o,N(0,"info"),a.urlInput.value=r):r=a.urlInput.value.trim(),r&&J(r,await Q()>0),!localStorage.getItem("helpModalShown")&&a.helpModal&&setTimeout(()=>{a.helpModal.classList.add("show"),N(0,"info")},1e3);const l="https://rt-glb.rttv.com/dvr/rtnews/playlist_4500Kb.m3u8",i=localStorage.getItem("lastPlayedVideoUrl");i&&a.urlInput?(a.urlInput.value=i,N(0,"info")):a.urlInput&&(a.urlInput.value=l,N(0,"info")),await A(),a.historyBody&&a.historyBody.classList.add("show");const d=g();d&&0===(await d.getAllRecords()).length&&(localStorage.getItem("hasAutoImported")||await async function(){try{const e=await fetch("/play-history-2026-01-17.m3u");if(!e.ok)throw new Error("文件不存在或无法访问");const t=(await e.text()).split("\n"),s=[];let n="";for(let c=0;c<t.length;c++){const e=t[c].trim();if(e.startsWith("#EXTINF:")){const t=e.split(",");t.length>1&&(n=t.slice(1).join(",").trim())}else e&&!e.startsWith("#")&&n&&e&&(s.push({url:e,title:n,date:(new Date).toISOString(),time:0,duration:0,playCount:1}),n="")}if(0===s.length)throw new Error("没有找到有效的播放历史记录");const o=document.getElementById("playlist-select"),r=`auto_imported_${Date.now()}`,l=`自动导入的播放列表_${(new Date).toISOString().slice(0,10)}`,a=document.createElement("option");a.value=r,a.textContent=l,o.appendChild(a);const i=JSON.parse(localStorage.getItem("playlists"))||[];i.push({id:r,name:l}),localStorage.setItem("playlists",JSON.stringify(i)),function(e,t){const s=indexedDB.open("PlaylistDB",1);s.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains("playlists")||t.createObjectStore("playlists",{keyPath:"id"})},s.onsuccess=s=>{const n=s.target.result,o=n.transaction("playlists","readwrite");o.objectStore("playlists").put({id:e,history:t}),o.oncomplete=()=>{n.close(),N(0,"success")},o.onerror=e=>{N(e.target.error,"error")}},s.onerror=e=>{N(e.target.error,"error")}}(r,s),N(s.length,"success"),localStorage.setItem("hasAutoImported","true")}catch(e){N(e.message,"info")}}()),N(0,"success")}}},function(){return t||(0,e[s(e)[0]])((t={exports:{}}).exports,t),t.exports});export default n();

var e=Object.getOwnPropertyNames;import"./i18n.DqZjOawE.js";var t,n,o=(t={"js/main.BQZPeHj8.js"(e,t){!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();class n{constructor(){this.dbName="videoPlayerDB",this.storeName="playHistory",this.dbVersion=1,this.db=null}async openDB(){return new Promise((e,t)=>{if(this.db)return void e(this.db);const n=indexedDB.open(this.dbName,this.dbVersion);n.onupgradeneeded=e=>{if(this.db=e.target.result,!this.db.objectStoreNames.contains(this.storeName)){const e=this.db.createObjectStore(this.storeName,{keyPath:"url",autoIncrement:!1});e.createIndex("date","date",{unique:!1}),e.createIndex("playCount","playCount",{unique:!1})}},n.onsuccess=t=>{this.db=t.target.result,e(this.db)},n.onerror=e=>{t(e.target.error)}})}async saveRecord(e){try{const t=await this.openDB(),n=t.transaction(this.storeName,"readwrite").objectStore(this.storeName);await new Promise((t,o)=>{const s=n.put(e);s.onsuccess=t,s.onerror=o})}catch(t){throw t}}async getAllRecords(e={}){const{sortBy:t="date",sortOrder:n="desc",limit:o=120}=e;try{const e=(await this.openDB()).transaction(this.storeName,"readonly"),s=e.objectStore(this.storeName).index(t);return new Promise((e,t)=>{const r=[],l="asc"===n?"next":"prev",a=s.openCursor(null,l);a.onsuccess=t=>{const n=t.target.result;n&&r.length<o?(r.push(n.value),n.continue()):e(r)},a.onerror=t})}catch(s){return[]}}async getRecord(e){try{const t=await this.openDB(),n=t.transaction(this.storeName,"readonly").objectStore(this.storeName);return new Promise((t,o)=>{const s=n.get(e);s.onsuccess=e=>t(e.target.result),s.onerror=o})}catch(t){return null}}async deleteRecord(e){try{const t=await this.openDB(),n=t.transaction(this.storeName,"readwrite").objectStore(this.storeName);await new Promise((t,o)=>{const s=n.delete(e);s.onsuccess=t,s.onerror=o})}catch(t){throw t}}async clearAllRecords(){try{const e=await this.openDB(),t=e.transaction(this.storeName,"readwrite").objectStore(this.storeName);await new Promise((e,n)=>{const o=t.clear();o.onsuccess=e,o.onerror=n})}catch(e){throw e}}async getRecordCount(){try{const e=await this.openDB(),t=e.transaction(this.storeName,"readonly").objectStore(this.storeName);return new Promise((e,n)=>{const o=t.count();o.onsuccess=t=>e(t.target.result),o.onerror=n})}catch(e){return 0}}}const o=new n;void 0!==t&&t.exports?t.exports=n:window.playHistoryStorage=o;let s=null,r=!1;window.i18n;const l={video:document.getElementById("video-player"),loadingMask:document.getElementById("loading-mask"),loadingText:document.getElementById("loading-text"),statusTip:document.getElementById("status-tip"),urlInput:document.getElementById("url-input"),urlClearBtn:document.getElementById("url-clear-btn"),fullscreenBtn:document.getElementById("fullscreen-btn"),pipBtn:document.getElementById("pip-btn"),screenshotBtn:document.getElementById("screenshot-btn"),shortcutBtn:document.getElementById("shortcut-btn"),clearCacheBtn:document.getElementById("clear-cache-btn"),helpBtn:document.getElementById("help-btn"),playlistBtn:document.getElementById("playlist-btn"),historyBtn:document.getElementById("history-btn"),historyPanel:document.getElementById("history-panel"),historyHeader:document.getElementById("history-header"),historyTitle:document.getElementById("historyTitle"),historyClear:document.getElementById("history-clear"),historyExport:document.getElementById("history-export"),historyImport:document.getElementById("history-import"),historyImportInput:document.getElementById("history-import-input"),historyBody:document.getElementById("history-body"),historyEmpty:document.getElementById("history-empty"),sortRecentBtn:document.getElementById("sort-recent"),sortHotBtn:document.getElementById("sort-hot"),alignLeftBtn:document.getElementById("align-left"),alignCenterBtn:document.getElementById("align-center"),alignRightBtn:document.getElementById("align-right"),volumeIcon:document.getElementById("volume-icon"),progressWrap:document.getElementById("progress-wrap"),progressBar:document.getElementById("progress-bar"),progressLoaded:document.getElementById("progress-loaded"),volumeSlider:document.getElementById("volume-slider"),speedSelect:document.getElementById("speed-select"),qualitySelect:document.getElementById("quality-select"),centerPlayBtn:document.getElementById("center-play-btn"),screenshotModal:document.getElementById("screenshot-modal"),screenshotImg:document.getElementById("screenshot-img"),screenshotClose:document.getElementById("screenshot-close"),screenshotDownload:document.getElementById("screenshot-download"),helpModal:document.getElementById("help-modal"),helpClose:document.getElementById("help-close"),playlistModal:document.getElementById("playlist-modal"),playlistClose:document.getElementById("playlist-close"),playlistModalTitle:document.getElementById("playlistModalTitle"),playlistFileBtn:document.getElementById("playlist-file-btn"),playlistFileBtnText:document.getElementById("playlistFileBtnText"),playlistFileInput:document.getElementById("playlist-file-input"),playlistImportBtn:document.getElementById("playlist-import-btn"),playlistImportBtnText:document.getElementById("playlistImportBtnText"),playlistClearBtn:document.getElementById("playlist-clear-btn"),playlistClearBtnText:document.getElementById("playlistClearBtnText"),playlistTextarea:document.getElementById("playlist-textarea"),playlistList:document.getElementById("playlist-list"),playlistEmpty:document.getElementById("playlist-empty"),shortcutTip:document.getElementById("shortcut-tip"),touchTip:document.getElementById("touch-tip"),langLabel:document.getElementById("langLabel"),themeLabel:document.getElementById("themeLabel"),speedLabel:document.getElementById("speedLabel"),qualityLabel:document.getElementById("qualityLabel"),shortcutTitle:document.getElementById("shortcutTitle"),shortcutPlay:document.getElementById("shortcutPlay"),shortcutForward:document.getElementById("shortcutForward"),shortcutBackward:document.getElementById("shortcutBackward"),shortcutVolUp:document.getElementById("shortcutVolUp"),shortcutVolDown:document.getElementById("shortcutVolDown"),shortcutFullscreen:document.getElementById("shortcutFullscreen"),shortcutPip:document.getElementById("shortcutPip"),shortcutScreenshot:document.getElementById("shortcutScreenshot"),pageTitle:document.getElementById("pageTitle"),langSelect:document.getElementById("lang-select"),themeSelect:document.getElementById("theme-select"),logHeader:document.getElementById("log-header"),logBody:document.getElementById("log-body"),logTitle:document.getElementById("logTitle"),logClear:document.getElementById("log-clear"),sidebar:document.getElementById("sidebar"),sidebarToggle:document.getElementById("sidebar-toggle"),historySidebarToggle:document.getElementById("history-sidebar-toggle")};let a=null,i=!1,c="",d=null,u=null,m=localStorage.getItem("playerLang")||"zh-CN",p=null;function y(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}function h(){return window.playHistoryStorage||null}function g(e){if(!e||"string"!=typeof e)return!1;try{const t=new URL(e);return["http:","https:"].includes(t.protocol)}catch(t){return/^https?:\/\/.+\.(m3u8|mp4|webm|ogg|avi|mov|wmv)/i.test(e)||/^https?:\/\/.+\/playlist\.m3u8/i.test(e)}}const v="playerPlaylist_v1";function f(){try{const e=localStorage.getItem(v);if(!e)return{version:1,epgUrls:[],items:[]};const t=JSON.parse(e);if(!t||"object"!=typeof t)return{version:1,epgUrls:[],items:[]};const n=Array.isArray(t.epgUrls)?t.epgUrls.filter(e=>"string"==typeof e):[];return{version:1,epgUrls:n,items:Array.isArray(t.items)?t.items.filter(e=>e&&"object"==typeof e):[]}}catch{return{version:1,epgUrls:[],items:[]}}}function E(e){const t={version:1,epgUrls:Array.isArray(e?.epgUrls)?e.epgUrls:[],items:Array.isArray(e?.items)?e.items:[]};localStorage.setItem(v,JSON.stringify(t))}function B(e){return"string"!=typeof e?"":function(e){if("string"!=typeof e)return"";const t=e.trim();return t.startsWith('"')&&t.endsWith('"')||t.startsWith("'")&&t.endsWith("'")?t.slice(1,-1).trim():t}(e.replace(/`/g,"").trim())}function w(e){const t=B(e);if(!t)return"";const n=t.indexOf("$");return(n>=0?t.slice(0,n):t).trim()}function L(){if(!l.playlistList||!l.playlistEmpty)return;const e=f();if(l.playlistList.innerHTML="",!e.items.length)return l.playlistList.appendChild(l.playlistEmpty),void(l.playlistEmpty.style.display="block");l.playlistEmpty.style.display="none";const t=document.createDocumentFragment();e.items.forEach(e=>{const n=document.createElement("div");n.className="playlist-item";const o=y(e.title||e.url),s=y(e.rawUrl||e.url),r=y(e.url),l=e.group?`<div class="playlist-item-meta">${y(e.group)}</div>`:"";n.innerHTML=`\n            <div class="playlist-item-content">\n                <div class="playlist-item-title">${o}</div>\n                ${l}\n                <div class="playlist-item-url" title="${s}">${s.length>80?`${s.slice(0,80)}...`:s}</div>\n            </div>\n            <div class="playlist-item-actions">\n                <button class="playlist-item-play" title="播放" data-url="${r}">\n                    <i class="fas fa-play"></i>\n                </button>\n            </div>\n        `,t.appendChild(n)}),l.playlistList.appendChild(t),l.playlistList&&(l.playlistList.removeEventListener("click",I),l.playlistList.addEventListener("click",I))}function I(e){const t=e.target.closest(".playlist-item-play");if(!t)return;const n=t.dataset.url;n&&(l.urlInput.value=n,J(n),b())}function S(){l.playlistModal&&(l.playlistModal.classList.add("show"),L())}function b(){l.playlistModal&&l.playlistModal.classList.remove("show")}function C(e){const t=function(e){const t=("string"==typeof e?e.replace(/\r\n?/g,"\n"):"").split("\n"),n=[],o=new Set;let s=null;for(const a of t){const e=B(a);if(!e)continue;if(e.startsWith("#EXTM3U")){(e.match(/https?:\/\/[^\s",]+/g)||[]).forEach(e=>o.add(e));continue}if(e.startsWith("#EXTINF")){const t={};e.replace(/([a-zA-Z0-9_-]+)\s*=\s*"([^"]*)"/g,(e,n,o)=>(t[n]=o,""));const n=e.lastIndexOf(","),o=n>=0?e.slice(n+1).trim():"";s={attrs:t,displayName:o};continue}if(e.startsWith("#"))continue;const t=w(e);if(!t)continue;const r={title:s?.displayName||s?.attrs?.["tvg-name"]||t,url:t,rawUrl:B(e),group:s?.attrs?.["group-title"]||"",logo:s?.attrs?.["tvg-logo"]||"",tvgId:s?.attrs?.["tvg-id"]||"",tvgName:s?.attrs?.["tvg-name"]||""};n.push(r),s=null}const r=[],l=new Set;for(const a of n)a?.url&&"string"==typeof a.url&&g(a.url)&&(l.has(a.url)||(l.add(a.url),r.push(a)));return{epgUrls:Array.from(o),items:r}}(e),n=f().items.length,o=function(e){const t=f(),n=new Set(t.items.map(e=>e?.url).filter(Boolean));for(const s of e.items||[])s?.url&&!n.has(s.url)&&(t.items.push(s),n.add(s.url));const o=new Set(t.epgUrls);for(const s of e.epgUrls||[])"string"==typeof s&&s&&o.add(s);return t.epgUrls=Array.from(o),E(t),t}(t),s=o.items.length-n;L(),M("zh-CN"===m?`播放列表导入完成：新增 ${s} 条，共 ${o.items.length} 条`:`Playlist imported: +${s}, total ${o.items.length}`,"success")}function T(e){const t=function(e){if(!e)return!1;const t=f(),n=t.items.findIndex(t=>t?.url===e);return!(n<0||(t.items.splice(n,1),E(t),l.playlistModal?.classList.contains("show")&&L(),0))}(e);t&&M("zh-CN"===m?"播放失败，已从导入列表移除该地址":"Playback failed, removed from imported list","error")}function x(e){m=e,localStorage.setItem("playerLang",e);const t=i18n[e];l.pageTitle&&(l.pageTitle.textContent=t.pageTitle),l.langLabel&&(l.langLabel.textContent=t.langLabel),l.themeLabel&&(l.themeLabel.textContent=t.themeLabel),l.speedLabel&&(l.speedLabel.textContent=t.speedLabel),l.qualityLabel&&(l.qualityLabel.textContent=t.qualityLabel),l.alignLabel&&(l.alignLabel.textContent=t.alignLabel),l.loadPlayText&&(l.loadPlayText.textContent=t.loadPlayBtn);const n=(e,t,n)=>{e&&(e.innerHTML=`<i class="${t}"></i> <span>${y(n)}</span>`)};n(l.pauseBtn,"fas fa-pause",t.pauseBtn),n(l.fullscreenBtn,"fas fa-expand",t.fullscreenBtn),n(l.pipBtn,"fas fa-expand-arrows-alt",t.pipBtn),n(l.screenshotBtn,"fas fa-camera",t.screenshotBtn),n(l.shortcutBtn,"fas fa-keyboard",t.shortcutBtn),n(l.clearCacheBtn,"fas fa-trash",t.clearCacheBtn),n(l.historyBtn,"fas fa-history",t.historyBtn),n(l.playlistBtn,"fas fa-list",t.playlistBtn),l.urlInput&&(l.urlInput.placeholder=t.urlInputPlaceholder),l.shortcutTitle&&(l.shortcutTitle.textContent=t.shortcutTitle),l.historyTitle&&(l.historyTitle.textContent=t.historyTitle),l.historyClear&&(l.historyClear.textContent=t.clearHistoryBtn),l.shortcutPlay&&(l.shortcutPlay.textContent=t.shortcutPlay),l.shortcutForward&&(l.shortcutForward.textContent=t.shortcutForward),l.shortcutBackward&&(l.shortcutBackward.textContent=t.shortcutBackward),l.shortcutVolUp&&(l.shortcutVolUp.textContent=t.shortcutVolUp),l.shortcutVolDown&&(l.shortcutVolDown.textContent=t.shortcutVolDown),l.shortcutFullscreen&&(l.shortcutFullscreen.textContent=t.shortcutFullscreen),l.shortcutPip&&(l.shortcutPip.textContent=t.shortcutPip),l.shortcutScreenshot&&(l.shortcutScreenshot.textContent=t.shortcutScreenshot),l.touchTip&&(l.touchTip.textContent=t.touchTip),l.logTitle&&(l.logTitle.textContent=t.logTitle),l.screenshotDownload&&(l.screenshotDownload.textContent=t.screenshotDownload),l.playlistModalTitle&&(l.playlistModalTitle.textContent=t.playlistModalTitle),l.playlistFileBtnText&&(l.playlistFileBtnText.textContent=t.playlistFileBtn),l.playlistImportBtnText&&(l.playlistImportBtnText.textContent=t.playlistImportBtn),l.playlistClearBtnText&&(l.playlistClearBtnText.textContent=t.playlistClearBtn),l.playlistTextarea&&(l.playlistTextarea.placeholder=t.playlistTextareaPlaceholder),l.playlistEmpty&&(l.playlistEmpty.textContent=t.playlistEmpty),N(0,"info")}function k(e){document.body.className=e,localStorage.setItem("playerTheme",e),N(0,"info")}function N(e,t="info"){const n=new Date;n.getHours().toString().padStart(2,"0"),n.getMinutes().toString().padStart(2,"0"),n.getSeconds().toString().padStart(2,"0")}function M(e,t,n={}){if("string"!=typeof e)return;if(!l.statusTip)return;const{duration:o=3e3,keepVisible:s=!1,logLevel:r=("error"===t?"error":"success")}=n;l.statusTip.textContent=e,l.statusTip.className=`status-tip show ${t}`,N(0,r),s||(window.statusTipTimer&&clearTimeout(window.statusTipTimer),window.statusTipTimer=setTimeout(()=>{l.statusTip.classList.remove("show")},o))}function P(e=i18n[m].loadingText){i=!0,l.loadingMask&&l.loadingText&&(l.loadingMask.classList.add("show"),l.loadingText.textContent=e,M(e,"loading",{keepVisible:!0,logLevel:"info"}),N(0,"info"))}function R(){i=!1,l.loadingMask&&l.loadingMask.classList.remove("show"),l.statusTip&&l.statusTip.classList.remove("show"),N(0,"info")}function U(){const e=i18n[m].confirmClearCache||"确定要清理所有播放器设置缓存吗？这将删除您的现有设定，只保留播放记录。";confirm(e)?(localStorage.removeItem("playerPreferredSpeed"),localStorage.removeItem("playerTheme"),localStorage.removeItem("playerLang"),localStorage.removeItem("playerVolume"),localStorage.removeItem("playerMuted"),localStorage.removeItem("playerQuality"),localStorage.removeItem("historySortMode"),localStorage.removeItem("playerAlignment"),localStorage.removeItem("helpModalShown"),localStorage.removeItem("lastPlayedVideoUrl"),l.urlInput&&(l.urlInput.value=""),l.speedSelect.value="1",l.video.playbackRate=1,l.langSelect.value="zh-CN",l.volumeSlider.value=.5,l.video.volume=.5,l.video.muted=!1,K(),x("zh-CN"),document.body.classList.remove("player-align-left","player-align-center","player-align-right"),document.body.classList.add("player-align-center"),l.alignLeftBtn&&l.alignLeftBtn.classList.remove("active"),l.alignCenterBtn&&l.alignCenterBtn.classList.add("active"),l.alignRightBtn&&l.alignRightBtn.classList.remove("active"),l.sortRecentBtn&&l.sortHotBtn&&(l.sortRecentBtn.classList.add("active"),l.sortHotBtn.classList.remove("active")),M(i18n[m].statusSuccessClearCache,"success"),N(0,"success")):N(0,"info")}function D(e){localStorage.setItem("playerPreferredSpeed",e),N(0,"info")}function $(){try{if(!l.video.src||0===l.video.videoWidth||0===l.video.videoHeight)return void M(i18n[m].statusErrorScreenshot.replace("{msg}","视频未加载或无效"),"error");const e=document.createElement("canvas");e.width=l.video.videoWidth,e.height=l.video.videoHeight,e.getContext("2d").drawImage(l.video,0,0,e.width,e.height);const t=e.toDataURL("image/png");l.screenshotImg.src=t,l.screenshotModal.classList.add("show"),l.screenshotDownload.onclick=()=>{const e=document.createElement("a");e.href=t;const n=(new Date).toISOString().replace(/[:.]/g,"-"),o="zh-CN"===m?`视频截图_${n}.png`:`Video_Screenshot_${n}.png`;e.download=o,e.click(),M(i18n[m].statusSuccessScreenshotDownload,"success")},M(i18n[m].statusSuccessScreenshot,"success")}catch(e){e.message.includes("Not allowed to load local resource")||e.message.includes("blob:")?M(i18n[m].statusErrorScreenshot.replace("{msg}","浏览器安全限制，无法生成截图"),"error"):M(i18n[m].statusErrorScreenshot.replace("{msg}",e.message),"error")}}function F(){document.pictureInPictureElement?document.exitPictureInPicture().then(()=>{const e=l.pipBtn.querySelector("span");e&&(e.textContent="zh-CN"===m?"画中画":"PiP"),M(i18n[m].statusSuccessExitPip,"success")}).catch(e=>{M(i18n[m].statusErrorPip.replace("{action}","zh-CN"===m?"退出":"Exit ").replace("{msg}",e.message),"error")}):l.video.requestPictureInPicture().then(()=>{const e=l.pipBtn.querySelector("span");e&&(e.textContent="zh-CN"===m?"退出画中画":"Exit PiP"),M(i18n[m].statusSuccessPip,"success")}).catch(e=>{M(i18n[m].statusErrorPip.replace("{action}","zh-CN"===m?"进入":"Enter ").replace("{msg}",e.message),"error")})}function q(){if(document.fullscreenElement){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen();const e=l.fullscreenBtn.querySelector("span");e&&(e.textContent="zh-CN"===m?"全屏":"Fullscreen"),M(i18n[m].statusSuccessExitFullscreen,"success")}else{l.video.requestFullscreen?l.video.requestFullscreen():l.video.webkitRequestFullscreen?l.video.webkitRequestFullscreen():l.video.msRequestFullscreen&&l.video.msRequestFullscreen();const e=l.fullscreenBtn.querySelector("span");e&&(e.textContent="zh-CN"===m?"退出全屏":"Exit Fullscreen"),M(i18n[m].statusSuccessFullscreen,"success")}}function z(){navigator.onLine?(l.statusTip.classList.remove("show"),c&&l.video.paused&&(d=setInterval(()=>{i||(P(i18n[m].statusReconnect),J(c,!0))},3e3)),N(0,"info")):(M(i18n[m].statusOffline,"offline"),l.video.pause(),d&&clearInterval(d),N(0,"error"))}async function O(e,t=0){try{if("string"!=typeof e)throw new TypeError("URL必须是字符串类型");if(!e)return;if(!g(e))return void N(0,"warn");if("number"!=typeof t||isNaN(t))throw new TypeError("播放时间必须是数字类型");p&&clearTimeout(p),p=setTimeout(async()=>{try{const n=h();if(!n)return;const o=await n.getRecord(e),s={url:e,title:o?o.title:e.split("/").pop().split("?")[0]||"未命名视频",time:Math.round(t),duration:Math.round(l.video.duration||o?.duration||0),date:(new Date).toISOString(),playCount:(o?.playCount||0)+1};await n.saveRecord(s),N(0,"info"),await j()}catch(n){N(n.message,"error")}},2e3)}catch(n){N(n.message,"error")}}async function V(e="date",t="desc"){try{const n=h();return n?await n.getAllRecords({sortBy:e,sortOrder:t}):[]}catch(n){return[]}}async function j(e=null){const t=e||localStorage.getItem("historySortMode")||"recent";let n,o;localStorage.setItem("historySortMode",t),"hot"===t?(n="playCount",o="desc"):(n="date",o="desc"),l.sortRecentBtn&&l.sortHotBtn&&(l.sortRecentBtn.classList.toggle("active","recent"===t),l.sortHotBtn.classList.toggle("active","hot"===t));const s=await V(n,o),r=l.historyBody,a=l.historyEmpty;if(r.innerHTML="",0===s.length)r.appendChild(a),a.style.display="block";else{a.style.display="none";const e=document.createDocumentFragment();s.forEach(t=>{const n=document.createElement("div"),o=c===t.url;n.className="history-item "+(o?"current-playing":"");const s=new Date(t.date).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),r=t.duration>0?Math.round(t.time/t.duration*100):0;n.innerHTML=`\n                <div class="history-item-content">\n                    <div class="history-item-title-container">\n                        <span class="history-item-title" data-url="${y(t.url)}">${y(t.title)}</span>\n                        <button class="history-item-edit" title="编辑名称" data-url="${y(t.url)}">\n                            <i class="fas fa-edit"></i>\n                        </button>\n                    </div>\n                    <div class="history-item-meta">\n                        <span class="history-item-date">${s}</span>\n                        ${t.duration>0?`<span class="history-item-time">播放进度：${W(t.time)} / ${W(t.duration)} (${r}%)</span>`:""}\n                        <span class="history-item-playcount"><i class="fas fa-fire" style="color: #ff9800; margin-right: 4px;"></i>${t.playCount||1}次播放</span>\n                    </div>\n                    <div class="history-item-url" title="${y(t.url)}">${y(t.url.length>50?`${t.url.substring(0,50)}...`:t.url)}</div>\n                </div>\n                <div class="history-item-actions">\n                    <button class="history-item-play" title="播放" data-url="${y(t.url)}">\n                        <i class="fas fa-play"></i>\n                    </button>\n                    <button class="history-item-delete" title="删除" data-url="${y(t.url)}">\n                        <i class="fas fa-trash"></i>\n                    </button>\n                </div>\n            `,e.appendChild(n)}),r.appendChild(e)}!function(){const e=l.historyBody;e.removeEventListener("click",A),e.addEventListener("click",A)}()}function A(e){const t=e.target;if(t.closest(".history-item-play")){const e=t.closest(".history-item-play").dataset.url;l.urlInput.value=e,J(e)}else t.closest(".history-item-delete")?async function(e){try{const t=h();if(!t)return;await t.deleteRecord(e),await j(),N(0,"info")}catch(t){M("删除播放历史失败","error")}}(t.closest(".history-item-delete").dataset.url):t.closest(".history-item-edit")&&async function(e){try{const t=h();if(!t)return;const n=await t.getRecord(e);if(!n)return;const o=prompt("请输入新的名称：",n.title);null!==o&&""!==o.trim()&&(n.title=o.trim(),await t.saveRecord(n),await j(),N(0,"info"))}catch(t){M("编辑播放历史失败","error")}}(t.closest(".history-item-edit").dataset.url)}async function H(){try{const e=await V(),t=JSON.stringify(e,null,2),n=new Blob([t],{type:"application/json"}),o=URL.createObjectURL(n),s=document.createElement("a");s.href=o,s.download=`video-play-history-${(new Date).toISOString().slice(0,10)}.json`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(o),N(0,"info"),M("播放历史导出成功","success")}catch(e){M("导出播放历史失败","error")}}function W(e){if(!e||isNaN(e))return"00:00";const t=Math.floor(e/60),n=Math.floor(e%60);return`${t.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`}function _(e,t){!e||t<5||(O(e,t),N(Math.round(t),"info"))}async function X(e){try{return 0}catch(t){return 0}}async function J(e,t=!1){try{if("string"!=typeof e)throw new TypeError("URL必须是字符串类型");if(!e||!e.trim())return void M(i18n[m].statusErrorUrl,"error");const i=e.trim();if(!function(e){return!!g(e)&&([".m3u8",".mp4",".webm",".ogg",".avi",".mov",".wmv"].some(t=>e.toLowerCase().includes(t))||/\/playlist\.m3u8/i.test(e))}(i))return M("错误：请输入有效的视频URL（支持m3u8、mp4、webm、ogg、avi、mov、wmv格式）","error"),void N(0,"error");if(c=i,localStorage.setItem("lastPlayedVideoUrl",i),N(0,"info"),R(),a&&(a.destroy(),a=null,N(0,"info")),l.video.pause(),l.video.src&&(l.video.src="",l.video.mediaSource))try{l.video.mediaSource.endOfStream()}catch(n){}if(l.fullscreenBtn.disabled=!0,l.pipBtn.disabled=!0,l.screenshotBtn.disabled=!0,l.qualitySelect.disabled=!0,l.progressBar.style.width="0%",l.progressLoaded.style.width="0%",d&&(clearInterval(d),d=null),P(i18n[m].loadingText),e.toLowerCase().includes(".m3u8"))try{r||await async function(){if(!r)try{const e=document.createElement("script");e.src="https://cdn.jsdelivr.net/npm/hls.js@latest",e.async=!0,await new Promise((t,n)=>{e.onload=t,e.onerror=n,document.head.appendChild(e)}),s=window.Hls,r=!0}catch(e){throw e}}(),s.isSupported()?(a=new s({maxBufferLength:30,startLevel:-1,enableWorker:!0,lowLatencyMode:!0}),a.attachMedia(l.video),a.on(s.Events.MANIFEST_PARSED,async()=>{if(R(),function(e){if(!e||!e.levels||0===e.levels.length)return l.qualitySelect.disabled=!0,void(l.qualitySelect.innerHTML='<option value="">自动</option>');l.qualitySelect.innerHTML='<option value="">自动</option>',l.qualitySelect.disabled=!1,e.levels.forEach((e,t)=>{const n=Math.round(e.bitrate/1e3),o=`${e.width||"Unknown"}x${e.height||"Unknown"} (${n}kbps)`,s=document.createElement("option");s.value=t,s.textContent=o,l.qualitySelect.appendChild(s)});const t=localStorage.getItem("playerQuality");t&&(l.qualitySelect.value=t,e.currentLevel=""===t?-1:Number(t)),l.qualitySelect.addEventListener("change",()=>{const t=l.qualitySelect.value;e.currentLevel=""===t?-1:Number(t),localStorage.setItem("playerQuality",t);const n=""===t?"zh-CN"===m?"自动":"Auto":l.qualitySelect.options[l.qualitySelect.selectedIndex].text;M(i18n[m].statusSuccessQuality.replace("{quality}",n),"success")})}(a),t){const e=await X();e>0&&(l.video.currentTime=e)}M(i18n[m].statusSuccessLoad,"success"),l.fullscreenBtn.disabled=!1,l.pipBtn.disabled=!("pictureInPictureEnabled"in document),l.screenshotBtn.disabled=!1,await O(e),l.video.play().catch(e=>{})}),a.on(s.Events.LOADING_PROGRESS,(e,t)=>{const n=t.loaded/t.total*100;l.progressLoaded.style.width=`${n}%`}),a.on(s.Events.ERROR,(e,t)=>{R();let n=i18n[m].statusErrorLoad;if(t.fatal)switch(t.type){case s.ErrorTypes.NETWORK_ERROR:n=i18n[m].statusErrorNetwork,a.startLoad();break;case s.ErrorTypes.MEDIA_ERROR:n=i18n[m].statusErrorDecode,a.recoverMediaError();break;default:n=i18n[m].statusErrorUnknown.replace("{msg}",t.details),T(c),a.destroy(),a=null,l.video.src="",l.fullscreenBtn.disabled=!0,l.pipBtn.disabled=!0,l.screenshotBtn.disabled=!0}M(n,"error")}),a.loadSource(e)):l.video.canPlayType("application/vnd.apple.mpegurl")?(l.video.src=e,l.video.addEventListener("loadedmetadata",async()=>{if(R(),t){const e=await X();e>0&&(l.video.currentTime=e)}M(i18n[m].statusSuccessLoadNative,"success"),l.fullscreenBtn.disabled=!1,l.pipBtn.disabled=!("pictureInPictureEnabled"in document),l.screenshotBtn.disabled=!1,await O(e),l.video.play().catch(e=>{})},{once:!0}),l.video.addEventListener("error",e=>{R();const t="zh-CN"===m?"视频加载失败：无法播放此格式":"Video load failed: Format not supported";M(i18n[m].statusErrorVideo.replace("{msg}",t),"error"),T(c)},{once:!0})):(R(),M(i18n[m].statusErrorUnknown.replace("{msg}","当前浏览器不支持播放 m3u8 格式"),"error"),l.video.src="")}catch(o){R(),M(i18n[m].statusErrorUnknown.replace("{msg}","hls.js 加载失败"),"error"),N(o.message,"error")}else l.video.src=e,l.video.addEventListener("loadedmetadata",async()=>{if(R(),t){const e=await X();e>0&&(l.video.currentTime=e)}M(i18n[m].statusSuccessLoad,"success"),l.fullscreenBtn.disabled=!1,l.pipBtn.disabled=!("pictureInPictureEnabled"in document),l.screenshotBtn.disabled=!1,await O(e),l.video.play().catch(e=>{})},{once:!0}),l.video.addEventListener("error",e=>{R();let t="";const n=l.video.error;if(n){const e={1:"zh-CN"===m?"视频加载被中止":"Video load aborted",2:"zh-CN"===m?"网络请求失败":"Network request failed",3:"zh-CN"===m?"视频解码失败":"Video decoding failed",4:"zh-CN"===m?"视频格式不支持":"Video format not supported",5:"zh-CN"===m?"视频加载超时":"Video load timeout"};t=n.message&&n.message.includes("has no supported sources")?"zh-CN"===m?"视频没有有效的源":"The video has no supported sources":e[n.code]||n.message||"Unknown error"}else t="zh-CN"===m?"视频加载失败":"Video load failed";M(i18n[m].statusErrorVideo.replace("{msg}",t),"error"),T(c)},{once:!0})}catch(o){R(),M(`视频加载异常：${o.message||"未知错误"}`,"error"),N(o.message,"error")}}async function Q(e){const t=document.getElementById("history-body");if(document.getElementById("history-empty"),"default"===e)return await j(),void N(0,"info");t.innerHTML="";const n=await async function(e){return new Promise((t,n)=>{const o=indexedDB.open("PlaylistDB",1);o.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains("playlists")||t.createObjectStore("playlists",{keyPath:"id"})},o.onsuccess=o=>{const s=o.target.result,r=s.transaction("playlists","readonly").objectStore("playlists").get(e);r.onsuccess=e=>{const n=e.target.result,o=n?n.history:[];t(o),s.close()},r.onerror=e=>{n(e.target.error),s.close()}},o.onerror=e=>{n(e.target.error)}})}(e);if(0===n.length){const e=document.createElement("div");e.className="history-empty",e.textContent="暂无播放历史",t.appendChild(e)}else n.forEach(e=>{const n=document.createElement("div");n.className="history-item",n.innerHTML=`\n                <div class="history-item-title">${e.title||e.url}</div>\n                <div class="history-item-time">${new Date(e.lastPlayed).toLocaleString()}</div>\n                <button class="history-item-play" data-url="${e.url}">播放</button>\n            `,t.appendChild(n)}),document.querySelectorAll(".history-item-play").forEach(e=>{e.addEventListener("click",()=>{J(e.getAttribute("data-url"))})});N(0,"info")}function K(){const e=l.video.volume,t=l.volumeIcon;l.video.muted||0===e?t.className="fas fa-volume-mute":t.className=e<.5?"fas fa-volume-down":"fas fa-volume-up"}function Y(){l.centerPlayBtn&&(l.video.paused||l.video.ended?l.centerPlayBtn.classList.remove("hide"):l.centerPlayBtn.classList.add("hide"))}function G(){function e(){l.urlInput.value.trim()?l.urlClearBtn.classList.add("visible"):l.urlClearBtn.classList.remove("visible")}l.video.addEventListener("play",()=>{Y(),M(i18n[m].statusSuccessPlay,"success")}),l.video.addEventListener("pause",()=>{_(c,l.video.currentTime),Y(),M(i18n[m].statusSuccessPause,"success")}),l.video.addEventListener("ended",()=>{_(c,0),Y(),M(i18n[m].statusSuccessEnd,"success")}),l.centerPlayBtn.addEventListener("click",()=>{if(i)return;const e=l.urlInput.value.trim();e?c!==e?J(e):l.video.paused||l.video.ended?l.video.play().catch(e=>{M(i18n[m].statusErrorUnknown.replace("{msg}",e.message),"error")}):l.video.pause():M(i18n[m].statusErrorUrl,"error")}),l.fullscreenBtn.addEventListener("click",q),document.addEventListener("fullscreenchange",()=>{const e=l.fullscreenBtn.querySelector("span");e&&(e.textContent=document.fullscreenElement?"zh-CN"===m?"退出全屏":"Exit Fullscreen":"zh-CN"===m?"全屏":"Fullscreen")}),document.addEventListener("webkitfullscreenchange",()=>{const e=l.fullscreenBtn.querySelector("span");e&&(e.textContent=document.webkitFullscreenElement?"zh-CN"===m?"退出全屏":"Exit Fullscreen":"zh-CN"===m?"全屏":"Fullscreen")}),l.pipBtn.addEventListener("click",F),l.video.addEventListener("enterpictureinpicture",()=>{const e=l.pipBtn.querySelector("span");e&&(e.textContent="zh-CN"===m?"退出画中画":"Exit PiP")}),l.video.addEventListener("leavepictureinpicture",()=>{const e=l.pipBtn.querySelector("span");e&&(e.textContent="zh-CN"===m?"画中画":"PiP")}),l.screenshotBtn.addEventListener("click",$),l.screenshotClose.addEventListener("click",()=>{l.screenshotModal.classList.remove("show"),l.screenshotImg.src=""}),l.screenshotModal.addEventListener("click",e=>{e.target===l.screenshotModal&&(l.screenshotModal.classList.remove("show"),l.screenshotImg.src="")}),l.volumeSlider.addEventListener("input",()=>{l.video.volume=l.volumeSlider.value,l.video.muted=0==l.volumeSlider.value,localStorage.setItem("playerVolume",l.volumeSlider.value),localStorage.setItem("playerMuted",l.video.muted),K()}),l.volumeIcon.addEventListener("click",()=>{l.video.muted=!l.video.muted,l.video.muted?l.volumeSlider.value=0:(l.volumeSlider.value=localStorage.getItem("playerVolume")||.5,l.video.volume=l.volumeSlider.value),localStorage.setItem("playerVolume",l.volumeSlider.value),localStorage.setItem("playerMuted",l.video.muted),K()}),l.speedSelect.addEventListener("change",()=>{const e=l.speedSelect.value;l.video.playbackRate=e,D(e),M(i18n[m].statusSuccessSpeed.replace("{speed}",e),"success")}),l.video.addEventListener("timeupdate",()=>{if(!l.video.duration)return;const e=l.video.currentTime/l.video.duration*100;l.progressBar.style.width=`${e}%`,Y()}),l.video.addEventListener("progress",()=>{if(0===l.video.buffered.length)return;const e=l.video.buffered.end(l.video.buffered.length-1)/l.video.duration*100;l.progressLoaded.style.width=`${e}%`}),l.progressWrap.addEventListener("click",e=>{if(!l.video.duration)return;const t=l.progressWrap.getBoundingClientRect(),n=(e.clientX-t.left)/t.width;l.video.currentTime=n*l.video.duration,l.progressBar.style.width=100*n+"%"}),l.video.addEventListener("ended",()=>{_(c,0),M(i18n[m].statusSuccessEnd,"success")}),l.urlInput.addEventListener("keydown",e=>{if("Enter"===e.key){const e=l.urlInput.value.trim();e?J(e):M(i18n[m].statusErrorUrl,"error")}}),e(),l.urlInput.addEventListener("input",e),l.urlInput.addEventListener("focus",e),l.urlInput.addEventListener("blur",e),l.urlClearBtn.addEventListener("click",()=>{l.urlInput.value="",e(),l.urlInput.focus()}),l.langSelect.addEventListener("change",e=>{x(e.target.value)}),l.themeSelect.addEventListener("change",e=>{k(e.target.value)}),l.clearCacheBtn.addEventListener("click",U),window.addEventListener("online",z),window.addEventListener("offline",z),l.helpBtn&&l.helpModal&&l.helpClose&&(l.helpBtn.addEventListener("click",()=>{l.helpModal.classList.add("show"),N(0,"info")}),l.helpClose.addEventListener("click",Z),l.helpModal.addEventListener("click",e=>{e.target===l.helpModal&&Z()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&l.helpModal.classList.contains("show")&&Z()})),l.playlistBtn&&l.playlistModal&&l.playlistClose&&(l.playlistBtn.addEventListener("click",()=>{S(),N(0,"info")}),l.playlistClose.addEventListener("click",b),l.playlistModal.addEventListener("click",e=>{e.target===l.playlistModal&&b()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&l.playlistModal.classList.contains("show")&&b()}),l.playlistFileBtn&&l.playlistFileInput&&(l.playlistFileBtn.addEventListener("click",()=>{l.playlistFileInput.click()}),l.playlistFileInput.addEventListener("change",async e=>{const t=e.target.files[0];if(t)try{const e=await function(e){return new Promise((t,n)=>{const o=new FileReader;o.onload=e=>t(e.target.result),o.onerror=e=>n(e.target.error||new Error("read file failed")),o.readAsText(e)})}(t);l.playlistTextarea&&(l.playlistTextarea.value=e),C(e)}catch(n){const e=n?.message||String(n);M("zh-CN"===m?`读取文件失败：${e}`:`Failed to read file: ${e}`,"error")}finally{e.target.value=""}})),l.playlistImportBtn&&l.playlistTextarea&&l.playlistImportBtn.addEventListener("click",()=>{const e=l.playlistTextarea.value||"";e.trim()?C(e):M("zh-CN"===m?"请先粘贴 M3U 内容":"Please paste M3U content first","error")}),l.playlistClearBtn&&l.playlistClearBtn.addEventListener("click",()=>{E({epgUrls:[],items:[]}),L(),M("zh-CN"===m?"播放列表已清空":"Playlist cleared","success")})),l.historySidebarToggle&&l.sidebar&&l.historySidebarToggle.addEventListener("click",async()=>{l.sidebar.classList.toggle("hidden"),!l.sidebar.classList.contains("hidden")&&l.historyBody&&l.historyBody.classList.add("show"),await j(),N(0,"info")}),l.historyExport&&l.historyExport.addEventListener("click",H);const t=document.getElementById("playlist-import"),n=document.getElementById("playlist-export"),o=document.getElementById("playlist-select");t&&t.addEventListener("click",()=>{S()}),n&&n.addEventListener("click",async()=>{await async function(){const e=h();if(!e)return void M("zh-CN"===m?"播放历史不可用，无法导出":"Play history unavailable","error");const t=await e.getAllRecords({sortBy:"date",sortOrder:"desc",limit:1e4});if(!t.length)return void M("zh-CN"===m?"播放历史为空，无法导出":"Play history is empty","error");const n=["#EXTM3U"];for(const a of t){const e=String(a?.title?a.title:a?.url||""),t=a?.url?String(a.url):"";t&&(n.push(`#EXTINF:-1,${e}`),n.push(t))}const o=n.join("\n")+"\n",s=new Blob([o],{type:"audio/x-mpegurl;charset=utf-8"}),r=URL.createObjectURL(s),l=document.createElement("a");l.href=r,l.download=`play-history-${(new Date).toISOString().slice(0,10)}.m3u`,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(r),M("zh-CN"===m?"已导出播放历史为 M3U":"Exported play history as M3U","success")}()}),o&&o.addEventListener("change",async()=>{const e=o.value;await Q(e),N(0,"info")});const s=document.getElementById("resize-handle"),r=document.getElementById("sidebar"),a=document.querySelector(".player-area");if(s&&r&&a){let e=!1,t=0,n=0;s.addEventListener("mousedown",o=>{e=!0,t=o.clientX,n=parseInt(document.defaultView.getComputedStyle(r).width,10),document.body.style.cursor="ew-resize",document.body.style.userSelect="none",document.body.classList.add("resizing"),o.preventDefault()}),document.addEventListener("mousemove",o=>{if(!e)return;const l=o.clientX-t,i=n+l;i<200||i>window.innerWidth/2||(r.style.width=`${i}px`,a.style.width=window.innerWidth-i-5+"px",s.style.left=`${i}px`,a.style.marginLeft=`${i+5}px`)}),document.addEventListener("mouseup",()=>{e=!1,document.body.style.cursor="",document.body.style.userSelect="",document.body.classList.remove("resizing")})}function d(e){document.body.classList.remove("player-align-left","player-align-center","player-align-right"),document.body.classList.add(`player-align-${e}`),l.alignLeftBtn&&l.alignLeftBtn.classList.remove("active"),l.alignCenterBtn&&l.alignCenterBtn.classList.remove("active"),l.alignRightBtn&&l.alignRightBtn.classList.remove("active"),"left"===e&&l.alignLeftBtn?l.alignLeftBtn.classList.add("active"):"center"===e&&l.alignCenterBtn?l.alignCenterBtn.classList.add("active"):"right"===e&&l.alignRightBtn&&l.alignRightBtn.classList.add("active"),localStorage.setItem("playerAlignment",e),N(0,"info")}(JSON.parse(localStorage.getItem("playlists"))||[]).forEach(e=>{const t=document.createElement("option");t.value=e.id,t.textContent=e.name,o.appendChild(t)}),j(),Y(),l.video.addEventListener("click",()=>{i||(l.video.paused||l.video.ended?l.video.play().catch(e=>{M(i18n[m].statusErrorUnknown.replace("{msg}",e.message),"error")}):l.video.pause())}),l.alignLeftBtn&&l.alignLeftBtn.addEventListener("click",()=>{d("left")}),l.alignCenterBtn&&l.alignCenterBtn.addEventListener("click",()=>{d("center")}),l.alignRightBtn&&l.alignRightBtn.addEventListener("click",()=>{d("right")}),d(localStorage.getItem("playerAlignment")||"center"),window.addEventListener("beforeunload",()=>{c&&(_(c,l.video.currentTime),O(c,l.video.currentTime)),D(l.video.playbackRate),N(0,"info")}),l.video&&l.video.addEventListener("ended",()=>{c&&O(c,l.video.duration)})}function Z(){l.helpModal&&(l.helpModal.classList.remove("show"),localStorage.setItem("helpModalShown","true"),N(0,"info"))}window.onload=async()=>{N(0,"info");const e=localStorage.getItem("playerTheme")||"light";l.themeSelect.value=e,k(e),l.langSelect&&(l.langSelect.value=m),x(m);const t=function(){const e=localStorage.getItem("playerPreferredSpeed")||"1";return N(0,"info"),e}();l.speedSelect.value=t,l.video.playbackRate=t;const n=localStorage.getItem("playerVolume"),o="true"===localStorage.getItem("playerMuted");n?(l.volumeSlider.value=n,l.video.volume=n):(l.volumeSlider.value=.5,l.video.volume=.5),l.video.muted=o,K(),document.addEventListener("keydown",e=>{if(document.activeElement!==l.urlInput)switch(e.key.toLowerCase()){case" ":e.preventDefault(),l.video.paused&&!i?l.video.play().then(()=>{M(i18n[m].statusSuccessPlay,"success")}).catch(e=>{M(i18n[m].statusErrorUnknown.replace("{msg}",e.message),"error")}):l.video.pause();break;case"arrowright":e.preventDefault(),l.video.currentTime=Math.min(l.video.currentTime+5,l.video.duration),l.progressBar.style.width=l.video.currentTime/l.video.duration*100+"%";break;case"arrowleft":e.preventDefault(),l.video.currentTime=Math.max(l.video.currentTime-5,0),l.progressBar.style.width=l.video.currentTime/l.video.duration*100+"%";break;case"arrowup":e.preventDefault();const t=Math.min(Number(l.video.volume)+.05,1);l.video.volume=t,l.volumeSlider.value=t;break;case"arrowdown":e.preventDefault();const n=Math.max(Number(l.video.volume)-.05,0);l.video.volume=n,l.volumeSlider.value=n;break;case"f":e.preventDefault(),q();break;case"p":e.preventDefault(),F();break;case"s":e.preventDefault(),$()}}),N(0,"info"),function(){let e=0;l.video.addEventListener("touchstart",t=>{const n=Date.now();n-e<300&&(t.preventDefault(),l.video.paused&&!i?l.video.play().then(()=>{M(i18n[m].statusSuccessPlay,"success")}).catch(e=>{M(i18n[m].statusErrorUnknown.replace("{msg}",e.message),"error")}):l.video.pause(),l.touchTip.classList.add("show"),clearTimeout(u),u=setTimeout(()=>{l.touchTip.classList.remove("show")},1e3)),e=n});let t=0,n=0;l.video.addEventListener("touchmove",e=>{if(1!==e.touches.length)return;const o=e.touches[0];if(0===t)return t=o.clientX,void(n=o.clientY);const s=o.clientX-t,r=o.clientY-n;if(Math.abs(s)>Math.abs(r)){e.preventDefault();const t=s/l.video.offsetWidth*l.video.duration;l.video.currentTime=Math.max(0,Math.min(l.video.currentTime+t,l.video.duration)),l.progressBar.style.width=l.video.currentTime/l.video.duration*100+"%"}else{e.preventDefault();const t=-r/l.video.offsetHeight,n=Math.max(0,Math.min(l.video.volume+t,1));l.video.volume=n,l.volumeSlider.value=n}t=o.clientX,n=o.clientY}),l.video.addEventListener("touchend",()=>{t=0,n=0}),N(0,"info")}(),G();const s=new URLSearchParams(window.location.search).get("url");let r="";"/play"===window.location.pathname?s?(r=s,l.urlInput.value=r):r=l.urlInput.value.trim():s?(r=s.startsWith("web+video://")?s.replace(/^web\+video:\/\//,"https://"):s,N(0,"info"),l.urlInput.value=r):r=l.urlInput.value.trim(),r&&J(r,await X()>0),!localStorage.getItem("helpModalShown")&&l.helpModal&&setTimeout(()=>{l.helpModal.classList.add("show"),N(0,"info")},1e3);const a="https://rt-glb.rttv.com/dvr/rtnews/playlist_4500Kb.m3u8",c=localStorage.getItem("lastPlayedVideoUrl");c&&l.urlInput?(l.urlInput.value=c,N(0,"info")):l.urlInput&&(l.urlInput.value=a,N(0,"info")),await j(),l.historyBody&&l.historyBody.classList.add("show");const d=h();d&&0===(await d.getAllRecords()).length&&(localStorage.getItem("hasAutoImported")||await async function(){try{const e=await fetch("/play-history-2026-01-17.m3u");if(!e.ok)throw new Error("文件不存在或无法访问");const t=(await e.text()).split("\n"),n=[];let o="";for(let c=0;c<t.length;c++){const e=t[c].trim();if(e.startsWith("#EXTINF:")){const t=e.split(",");t.length>1&&(o=t.slice(1).join(",").trim())}else e&&!e.startsWith("#")&&o&&e&&(n.push({url:e,title:o,date:(new Date).toISOString(),time:0,duration:0,playCount:1}),o="")}if(0===n.length)throw new Error("没有找到有效的播放历史记录");const s=document.getElementById("playlist-select"),r=`auto_imported_${Date.now()}`,l=`自动导入的播放列表_${(new Date).toISOString().slice(0,10)}`,a=document.createElement("option");a.value=r,a.textContent=l,s.appendChild(a);const i=JSON.parse(localStorage.getItem("playlists"))||[];i.push({id:r,name:l}),localStorage.setItem("playlists",JSON.stringify(i)),function(e,t){const n=indexedDB.open("PlaylistDB",1);n.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains("playlists")||t.createObjectStore("playlists",{keyPath:"id"})},n.onsuccess=n=>{const o=n.target.result,s=o.transaction("playlists","readwrite");s.objectStore("playlists").put({id:e,history:t}),s.oncomplete=()=>{o.close(),N(0,"success")},s.onerror=e=>{N(e.target.error,"error")}},n.onerror=e=>{N(e.target.error,"error")}}(r,n),N(n.length,"success"),localStorage.setItem("hasAutoImported","true")}catch(e){N(e.message,"info")}}()),N(0,"success")}}},function(){return n||(0,t[e(t)[0]])((n={exports:{}}).exports,n),n.exports});export default o();
